<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#FB4747">
    <title data-i18n="pageTitle">تقنية المعلومات | AndroGov</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        brandRed: '#FB4747',
                        brandBlue: '#4267B2',
                        brandDark: '#1E293B',
                        brandGray: '#F8FAFC'
                    },
                    fontFamily: {
                        sans: ['Tajawal', 'Inter', 'sans-serif'],
                        en: ['Inter', 'sans-serif']
                    }
                }
            }
        }
    </script>

    <style>
        .num-font { font-family: 'Inter', sans-serif; direction: ltr; display: inline-block; }
        
        /* Loading Overlay */
        .loading-overlay {
            position: fixed; inset: 0; background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(5px);
            z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 1rem;
            transition: opacity 0.5s ease, visibility 0.5s;
        }
        .dark .loading-overlay { background: rgba(15, 23, 42, 0.95); }
        .loading-overlay.hidden { opacity: 0; visibility: hidden; pointer-events: none; }
        .spinner {
            width: 48px; height: 48px; border: 5px solid rgba(66, 103, 178, 0.1);
            border-top-color: #4267B2; border-radius: 50%; animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        /* Server Pulse Animation */
        .server-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-inline-end: 6px; }
        .status-up { background-color: #10B981; box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7); animation: pulse-green 2s infinite; }
        .status-down { background-color: #EF4444; box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); animation: pulse-red 2s infinite; }
        
        @keyframes pulse-green {
            0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7); }
            70% { transform: scale(1); box-shadow: 0 0 0 6px rgba(16, 185, 129, 0); }
            100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); }
        }
    </style>
</head>
<body class="bg-brandGray dark:bg-slate-900 text-slate-800 dark:text-slate-100 font-sans transition-colors duration-300">

    <div id="loadingOverlay" class="loading-overlay">
        <div class="spinner"></div>
        <p class="text-sm font-bold text-slate-600 dark:text-slate-300">جاري تحميل لوحة التحكم التقنية...</p>
        <button onclick="document.getElementById('loadingOverlay').classList.add('hidden')" class="mt-4 text-xs text-blue-500 underline">تخطي الانتظار</button>
    </div>

    <div id="sidebar-container" class="no-print"></div>
    
    <div class="main-content-wrapper ltr:md:ml-72 rtl:md:mr-72 transition-all duration-300 flex flex-col min-h-screen">
        <div id="header-container" class="no-print"></div>

        <main class="p-6 space-y-6">
            
            <div class="flex flex-col md:flex-row justify-between items-end gap-4">
                <div>
                    <h1 class="text-2xl font-bold text-slate-900 dark:text-white flex items-center gap-2">
                        <i class="fa-solid fa-laptop-code text-brandRed"></i> <span data-i18n="headerTitle">تقنية المعلومات (IT)</span>
                    </h1>
                    <p class="text-sm text-slate-500 mt-1" data-i18n="headerDesc">إدارة البنية التحتية، الدعم الفني، والأصول الرقمية.</p>
                </div>
                <div class="flex gap-2">
                    <button onclick="openAssetModal()" class="px-4 py-2 bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-white rounded-lg text-sm font-bold hover:bg-slate-200 transition flex items-center gap-2">
                        <i class="fa-solid fa-barcode"></i> <span data-i18n="btnAddAsset">إضافة أصل</span>
                    </button>
                    <button onclick="openTicketModal()" class="px-6 py-2 bg-brandBlue text-white rounded-lg text-sm font-bold shadow-lg hover:bg-blue-700 transition flex items-center gap-2">
                        <i class="fa-solid fa-ticket"></i> <span data-i18n="btnAddTicket">تذكرة دعم</span>
                    </button>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                <div class="bg-white dark:bg-slate-800 p-5 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700">
                    <div class="flex justify-between items-start mb-2">
                        <p class="text-xs text-slate-500 dark:text-slate-400 font-bold uppercase" data-i18n="kpiTickets">تذاكر مفتوحة</p>
                        <div class="w-8 h-8 rounded-lg bg-orange-50 dark:bg-orange-900/30 text-orange-500 flex items-center justify-center"><i class="fa-solid fa-headset"></i></div>
                    </div>
                    <h3 class="text-2xl font-bold text-slate-900 dark:text-white num-font" id="stat-tickets">5</h3>
                    <p class="text-[10px] text-slate-400 mt-1" data-i18n="kpiTicketsSub">2 عالية الأولوية</p>
                </div>
                <div class="bg-white dark:bg-slate-800 p-5 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700">
                    <div class="flex justify-between items-start mb-2">
                        <p class="text-xs text-slate-500 dark:text-slate-400 font-bold uppercase" data-i18n="kpiHealth">حالة النظام</p>
                        <div class="w-8 h-8 rounded-lg bg-green-50 dark:bg-green-900/30 text-green-600 flex items-center justify-center"><i class="fa-solid fa-server"></i></div>
                    </div>
                    <h3 class="text-xl font-bold text-green-600 num-font">99.9%</h3>
                    <p class="text-[10px] text-green-500 mt-1" data-i18n="kpiUptime">جميع الخدمات تعمل</p>
                </div>
                <div class="bg-white dark:bg-slate-800 p-5 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700">
                    <div class="flex justify-between items-start mb-2">
                        <p class="text-xs text-slate-500 dark:text-slate-400 font-bold uppercase" data-i18n="kpiAssets">إجمالي الأصول</p>
                        <div class="w-8 h-8 rounded-lg bg-blue-50 dark:bg-blue-900/30 text-blue-600 flex items-center justify-center"><i class="fa-solid fa-desktop"></i></div>
                    </div>
                    <h3 class="text-2xl font-bold text-slate-900 dark:text-white num-font" id="stat-assets">45</h3>
                    <p class="text-[10px] text-slate-400 mt-1" data-i18n="kpiAssetsSub">12 غير معين</p>
                </div>
                <div class="bg-white dark:bg-slate-800 p-5 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700">
                    <div class="flex justify-between items-start mb-2">
                        <p class="text-xs text-slate-500 dark:text-slate-400 font-bold uppercase" data-i18n="kpiLicenses">تراخيص البرامج</p>
                        <div class="w-8 h-8 rounded-lg bg-purple-50 dark:bg-purple-900/30 text-purple-600 flex items-center justify-center"><i class="fa-solid fa-key"></i></div>
                    </div>
                    <h3 class="text-2xl font-bold text-slate-900 dark:text-white num-font">120</h3>
                    <p class="text-[10px] text-red-500 mt-1" data-i18n="kpiRenew">5 تجديد قريباً</p>
                </div>
            </div>

            <div class="bg-white dark:bg-slate-800 rounded-3xl shadow-sm border border-slate-100 dark:border-slate-700 min-h-[500px] flex flex-col">
                
                <div class="p-5 border-b border-slate-100 dark:border-slate-700 flex flex-col md:flex-row justify-between items-center gap-4">
                    <div class="flex bg-slate-100 dark:bg-slate-700 p-1 rounded-xl w-full md:w-auto">
                        <button onclick="switchTab('tickets')" id="btn-tickets" class="px-5 py-2 text-xs font-bold rounded-lg bg-white text-brandBlue shadow-sm transition-all tab-btn" data-i18n="tabTickets">الدعم الفني</button>
                        <button onclick="switchTab('assets')" id="btn-assets" class="px-5 py-2 text-xs font-bold rounded-lg text-slate-500 hover:text-slate-700 dark:text-slate-400 transition-all tab-btn" data-i18n="tabAssets">الأصول والعهدة</button>
                        <button onclick="switchTab('servers')" id="btn-servers" class="px-5 py-2 text-xs font-bold rounded-lg text-slate-500 hover:text-slate-700 dark:text-slate-400 transition-all tab-btn" data-i18n="tabServers">حالة الخوادم</button>
                    </div>
                </div>

                <div id="tab-tickets" class="tab-content block p-0">
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm text-right rtl:text-right ltr:text-left">
                            <thead class="bg-slate-50 dark:bg-slate-700/50 text-slate-500 dark:text-slate-400 text-xs font-bold uppercase">
                                <tr>
                                    <th class="p-4" data-i18n="colID">رقم التذكرة</th>
                                    <th class="p-4" data-i18n="colSubject">الموضوع</th>
                                    <th class="p-4" data-i18n="colUser">المستخدم</th>
                                    <th class="p-4" data-i18n="colPriority">الأولوية</th>
                                    <th class="p-4 text-center" data-i18n="colStatus">الحالة</th>
                                    <th class="p-4 text-center" data-i18n="colAction">إجراء</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-slate-100 dark:divide-slate-700" id="ticketsTable">
                                </tbody>
                        </table>
                    </div>
                </div>

                <div id="tab-assets" class="tab-content hidden p-0">
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm text-right rtl:text-right ltr:text-left">
                            <thead class="bg-slate-50 dark:bg-slate-700/50 text-slate-500 dark:text-slate-400 text-xs font-bold uppercase">
                                <tr>
                                    <th class="p-4" data-i18n="colAssetTag">الرقم التسلسلي</th>
                                    <th class="p-4" data-i18n="colType">النوع</th>
                                    <th class="p-4" data-i18n="colModel">الموديل</th>
                                    <th class="p-4" data-i18n="colUser">العهدة (المستخدم)</th>
                                    <th class="p-4 text-center" data-i18n="colStatus">الحالة</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-slate-100 dark:divide-slate-700" id="assetsTable">
                                </tbody>
                        </table>
                    </div>
                </div>

                <div id="tab-servers" class="tab-content hidden p-6">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6" id="serverGrid">
                        </div>
                </div>

            </div>

        </main>
    </div>

    <div id="ticketModal" class="fixed inset-0 bg-black/70 hidden z-50 flex items-center justify-center backdrop-blur-sm p-4">
        <div class="bg-white dark:bg-slate-800 w-full max-w-lg rounded-2xl shadow-2xl flex flex-col">
            <div class="p-5 border-b border-slate-100 dark:border-slate-700 flex justify-between items-center">
                <h3 class="font-bold text-lg dark:text-white" data-i18n="modTicketTitle">فتح تذكرة جديدة</h3>
                <button onclick="closeModal('ticketModal')" class="text-slate-400 hover:text-red-500"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <div class="p-6 space-y-4">
                <div>
                    <label class="block text-xs font-bold text-slate-500 mb-1" data-i18n="lblSubject">الموضوع</label>
                    <input type="text" id="tSubject" class="w-full border dark:border-slate-600 dark:bg-slate-700 rounded-lg p-2 text-sm dark:text-white" placeholder="مثال: الطابعة لا تعمل">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-bold text-slate-500 mb-1" data-i18n="lblCategory">التصنيف</label>
                        <select id="tCat" class="w-full border dark:border-slate-600 dark:bg-slate-700 rounded-lg p-2 text-sm dark:text-white">
                            <option>Hardware</option>
                            <option>Software</option>
                            <option>Network</option>
                            <option>Access</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-500 mb-1" data-i18n="lblPriority">الأولوية</label>
                        <select id="tPrio" class="w-full border dark:border-slate-600 dark:bg-slate-700 rounded-lg p-2 text-sm dark:text-white">
                            <option value="Normal">عادية</option>
                            <option value="High">عالية</option>
                            <option value="Critical">حرجة</option>
                        </select>
                    </div>
                </div>
                <div>
                    <label class="block text-xs font-bold text-slate-500 mb-1" data-i18n="lblDetails">التفاصيل</label>
                    <textarea id="tDesc" class="w-full border dark:border-slate-600 dark:bg-slate-700 rounded-lg p-2 text-sm h-24 dark:text-white"></textarea>
                </div>
            </div>
            <div class="p-5 border-t border-slate-100 dark:border-slate-700 flex justify-end gap-3">
                <button onclick="closeModal('ticketModal')" class="px-4 py-2 border dark:border-slate-600 rounded-lg text-xs font-bold dark:text-white" data-i18n="btnCancel">إلغاء</button>
                <button onclick="saveTicket()" class="px-6 py-2 bg-brandBlue text-white rounded-lg text-xs font-bold" data-i18n="btnSubmit">إرسال</button>
            </div>
        </div>
    </div>

    <div id="assetModal" class="fixed inset-0 bg-black/70 hidden z-50 flex items-center justify-center backdrop-blur-sm p-4">
        <div class="bg-white dark:bg-slate-800 w-full max-w-lg rounded-2xl shadow-2xl flex flex-col">
            <div class="p-5 border-b border-slate-100 dark:border-slate-700 flex justify-between items-center">
                <h3 class="font-bold text-lg dark:text-white" data-i18n="modAssetTitle">إضافة أصل جديد</h3>
                <button onclick="closeModal('assetModal')" class="text-slate-400 hover:text-red-500"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <div class="p-6 space-y-4">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-bold text-slate-500 mb-1" data-i18n="lblType">النوع</label>
                        <select id="aType" class="w-full border dark:border-slate-600 dark:bg-slate-700 rounded-lg p-2 text-sm dark:text-white">
                            <option>Laptop</option>
                            <option>Desktop</option>
                            <option>Monitor</option>
                            <option>Printer</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-500 mb-1" data-i18n="lblModel">الموديل</label>
                        <input type="text" id="aModel" class="w-full border dark:border-slate-600 dark:bg-slate-700 rounded-lg p-2 text-sm dark:text-white" placeholder="Dell Latitude...">
                    </div>
                </div>
                <div>
                    <label class="block text-xs font-bold text-slate-500 mb-1" data-i18n="lblTag">الرقم التسلسلي (Tag)</label>
                    <input type="text" id="aTag" class="w-full border dark:border-slate-600 dark:bg-slate-700 rounded-lg p-2 text-sm dark:text-white num-font" placeholder="ABC-12345">
                </div>
                <div>
                    <label class="block text-xs font-bold text-slate-500 mb-1" data-i18n="lblUser">تخصيص لـ (اختياري)</label>
                    <input type="text" id="aUser" class="w-full border dark:border-slate-600 dark:bg-slate-700 rounded-lg p-2 text-sm dark:text-white" placeholder="اسم الموظف">
                </div>
            </div>
            <div class="p-5 border-t border-slate-100 dark:border-slate-700 flex justify-end gap-3">
                <button onclick="closeModal('assetModal')" class="px-4 py-2 border dark:border-slate-600 rounded-lg text-xs font-bold dark:text-white" data-i18n="btnCancel">إلغاء</button>
                <button onclick="saveAsset()" class="px-6 py-2 bg-brandBlue text-white rounded-lg text-xs font-bold" data-i18n="btnSave">حفظ</button>
            </div>
        </div>
    </div>

    <script src="data/company_policy.js"></script>
    <script src="js/core/config.js"></script>
    <script src="js/core/i18n.js"></script>
    <script src="js/helpers/policy-helpers.js"></script>
    <script src="js/services/data-service.js"></script>
    <script src="js/components/role-switcher.js"></script>
    <script src="js/components/layout.js"></script>
    <script src="js/components/bot.js"></script>

    <script>
        // --- DATA STATE ---
        let tickets = [
            { id: "IT-901", subject: "مشكلة في الدخول للنظام", user: "Mohammed (CFO)", prio: "High", status: "Open" },
            { id: "IT-902", subject: "طلب تثبيت Office 365", user: "Sarah (HR)", prio: "Normal", status: "In Progress" },
            { id: "IT-903", subject: "الطابعة لا تعمل", user: "Admin", prio: "Normal", status: "Open" },
            { id: "IT-904", subject: "VPN Access Error", user: "Hadi (Sales)", prio: "Critical", status: "Closed" }
        ];

        let assets = [
            { tag: "NB-001", type: "Laptop", model: "Dell XPS 15", user: "Mohammed (CFO)", status: "Assigned" },
            { tag: "NB-002", type: "Laptop", model: "MacBook Pro", user: "Akhtar (IT)", status: "Assigned" },
            { tag: "DSK-101", type: "Desktop", model: "HP EliteOne", user: "-", status: "Available" },
            { tag: "PRN-201", type: "Printer", model: "Canon MF645", user: "HR Dept", status: "Assigned" }
        ];

        let servers = [
            { name: "Main App Server", ip: "192.168.1.10", status: "up", load: "45%" },
            { name: "Database DB01", ip: "192.168.1.15", status: "up", load: "60%" },
            { name: "Backup Server", ip: "192.168.1.20", status: "down", load: "0%" }
        ];

        // --- INIT ---
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                const overlay = document.getElementById('loadingOverlay');
                if(overlay) overlay.classList.add('hidden');
            }, 2000);

            const checkSystem = setInterval(() => {
                if (typeof Layout !== 'undefined' && typeof AppConfig !== 'undefined') {
                    clearInterval(checkSystem);
                    if (!AppConfig.getCurrentUser()) {
                        const defaultUser = DataService.getUserById('USR_004') || DataService.getUsers()[0];
                        if (defaultUser) AppConfig.setCurrentUser(defaultUser);
                    }
                    Layout.init();
                    initPage();
                }
            }, 50);
        });

        function initPage() {
            updatePageLanguage();
            renderAllTabs();
        }

        function updatePageLanguage() {
            const lang = AppConfig.getLang() || 'ar';
            const dict = t[lang];
            document.documentElement.lang = lang;
            document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
            
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if(dict[key]) el.innerText = dict[key];
            });
            document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
                const key = el.getAttribute('data-i18n-placeholder');
                if(dict[key]) el.placeholder = dict[key];
            });
        }

        function renderAllTabs() {
            const lang = AppConfig.getLang() || 'ar';
            const dict = t[lang];
            
            // 1. Tickets
            const tBody = document.getElementById('ticketsTable');
            tBody.innerHTML = tickets.map(item => {
                let badge = item.status === 'Open' ? 'bg-red-100 text-red-700' : 
                            item.status === 'In Progress' ? 'bg-blue-100 text-blue-700' : 'bg-green-100 text-green-700';
                
                return `
                <tr class="hover:bg-slate-50 dark:hover:bg-slate-700/50 border-b dark:border-slate-700">
                    <td class="p-4 font-mono text-xs font-bold text-blue-600">${item.id}</td>
                    <td class="p-4 font-bold text-slate-800 dark:text-white text-xs">${item.subject}</td>
                    <td class="p-4 text-xs text-slate-500">${item.user}</td>
                    <td class="p-4 text-xs font-bold">${item.prio}</td>
                    <td class="p-4 text-center"><span class="${badge} px-2 py-1 rounded text-[10px] font-bold">${item.status}</span></td>
                    <td class="p-4 text-center">
                        ${item.status !== 'Closed' ? `<button onclick="closeTicket('${item.id}')" class="text-green-600 hover:text-green-800 text-xs font-bold border border-green-200 px-2 py-1 rounded">إغلاق</button>` : '-'}
                    </td>
                </tr>`;
            }).join('');
            document.getElementById('stat-tickets').innerText = tickets.filter(t => t.status !== 'Closed').length;

            // 2. Assets
            const aBody = document.getElementById('assetsTable');
            aBody.innerHTML = assets.map(item => `
                <tr class="hover:bg-slate-50 dark:hover:bg-slate-700/50 border-b dark:border-slate-700">
                    <td class="p-4 font-mono text-xs font-bold">${item.tag}</td>
                    <td class="p-4 text-xs text-slate-600 dark:text-slate-300">${item.type}</td>
                    <td class="p-4 text-xs text-slate-500">${item.model}</td>
                    <td class="p-4 font-bold text-slate-800 dark:text-white text-xs">${item.user}</td>
                    <td class="p-4 text-center text-xs">
                        <span class="${item.status === 'Assigned' ? 'bg-blue-100 text-blue-700' : 'bg-green-100 text-green-700'} px-2 py-0.5 rounded font-bold">${item.status}</span>
                    </td>
                </tr>
            `).join('');
            document.getElementById('stat-assets').innerText = assets.length;

            // 3. Servers
            const sGrid = document.getElementById('serverGrid');
            sGrid.innerHTML = servers.map(srv => `
                <div class="bg-white dark:bg-slate-800 border dark:border-slate-700 p-4 rounded-xl shadow-sm flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <span class="server-dot ${srv.status === 'up' ? 'status-up' : 'status-down'}"></span>
                        <div>
                            <h4 class="font-bold text-sm dark:text-white">${srv.name}</h4>
                            <p class="text-[10px] text-slate-400 font-mono">${srv.ip}</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="text-[10px] text-slate-400">Load</p>
                        <p class="font-bold font-mono text-xs dark:text-slate-200">${srv.load}</p>
                    </div>
                </div>
            `).join('');
        }

        // --- Logic Actions ---
        function switchTab(target) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('.tab-btn').forEach(el => {
                el.classList.remove('bg-white', 'text-brandBlue', 'shadow-sm');
                el.classList.add('text-slate-500');
            });
            document.getElementById(`tab-${target}`).classList.remove('hidden');
            document.getElementById(`btn-${target}`).classList.add('bg-white', 'text-brandBlue', 'shadow-sm');
        }

        function openTicketModal() { document.getElementById('ticketModal').classList.remove('hidden'); }
        function openAssetModal() { document.getElementById('assetModal').classList.remove('hidden'); }
        function closeModal(id) { document.getElementById(id).classList.add('hidden'); }

        function saveTicket() {
            const sub = document.getElementById('tSubject').value;
            if(!sub) return alert('الرجاء إدخال الموضوع');
            
            tickets.unshift({
                id: `IT-${Math.floor(Math.random()*1000)}`,
                subject: sub,
                user: "Me",
                prio: document.getElementById('tPrio').value,
                status: "Open"
            });
            renderAllTabs();
            closeModal('ticketModal');
        }

        function saveAsset() {
            const tag = document.getElementById('aTag').value;
            const model = document.getElementById('aModel').value;
            if(!tag) return alert('البيانات ناقصة');

            assets.unshift({
                tag: tag,
                type: document.getElementById('aType').value,
                model: model,
                user: document.getElementById('aUser').value || "-",
                status: document.getElementById('aUser').value ? "Assigned" : "Available"
            });
            renderAllTabs();
            closeModal('assetModal');
        }

        function closeTicket(id) {
            const t = tickets.find(x => x.id === id);
            if(t) {
                t.status = "Closed";
                renderAllTabs();
            }
        }

        // --- Bot ---
        const originalGetAIResponse = window.getAIResponse; 
        window.getAIResponse = function(query, isArabic) {
            const q = query.toLowerCase();
            if (q.includes('reset') || q.includes('password') || q.includes('كلمة المرور')) {
                return isArabic 
                    ? `يمكنك إعادة تعيين كلمة المرور من خلال صفحة "إعدادات النظام" أو التواصل مع الدعم الفني.`
                    : `You can reset your password from "System Settings" or contact IT support.`;
            }
            if (q.includes('vpn') || q.includes('remote') || q.includes('عن بعد')) {
                return isArabic
                    ? `للوصول عن بعد، تأكد من تثبيت Cisco AnyConnect واستخدام بيانات الدخول الخاصة بك.`
                    : `For remote access, ensure Cisco AnyConnect is installed and use your credentials.`;
            }
            return isArabic
                ? `يمكنني مساعدتك في: <b>إعادة تعيين كلمة المرور</b>، <b>مشاكل VPN</b>، أو <b>طلب جهاز جديد</b>.`
                : `I can help with: <b>Password Reset</b>, <b>VPN Issues</b>, or <b>New Device Request</b>.`;
        }

        const t = {
            ar: {
                pageTitle: "تقنية المعلومات",
                headerTitle: "تقنية المعلومات (IT)",
                headerDesc: "إدارة البنية التحتية والدعم الفني.",
                btnAddAsset: "إضافة أصل",
                btnAddTicket: "تذكرة دعم",
                kpiTickets: "تذاكر مفتوحة",
                kpiTicketsSub: "2 عالية الأولوية",
                kpiHealth: "حالة النظام",
                kpiUptime: "جميع الخدمات تعمل",
                kpiAssets: "إجمالي الأصول",
                kpiAssetsSub: "12 غير معين",
                kpiLicenses: "تراخيص البرامج",
                kpiRenew: "5 تجديد قريباً",
                tabTickets: "الدعم الفني",
                tabAssets: "الأصول والعهدة",
                tabServers: "حالة الخوادم",
                colID: "رقم التذكرة",
                colSubject: "الموضوع",
                colUser: "المستخدم",
                colPriority: "الأولوية",
                colStatus: "الحالة",
                colAction: "إجراء",
                colAssetTag: "الرقم التسلسلي",
                colType: "النوع",
                colModel: "الموديل",
                modTicketTitle: "فتح تذكرة جديدة",
                lblSubject: "الموضوع",
                lblCategory: "التصنيف",
                lblPriority: "الأولوية",
                lblDetails: "التفاصيل",
                modAssetTitle: "إضافة أصل جديد",
                lblType: "النوع",
                lblModel: "الموديل",
                lblTag: "الرقم التسلسلي",
                lblUser: "تخصيص لـ",
                btnCancel: "إلغاء",
                btnSubmit: "إرسال",
                btnSave: "حفظ"
            },
            en: {
                pageTitle: "IT Management",
                headerTitle: "Information Technology",
                headerDesc: "Manage Infrastructure & Support.",
                btnAddAsset: "Add Asset",
                btnAddTicket: "Support Ticket",
                kpiTickets: "Open Tickets",
                kpiTicketsSub: "2 High Priority",
                kpiHealth: "System Health",
                kpiUptime: "All Systems Operational",
                kpiAssets: "Total Assets",
                kpiAssetsSub: "12 Unassigned",
                kpiLicenses: "Licenses",
                kpiRenew: "5 Renewing Soon",
                tabTickets: "Helpdesk",
                tabAssets: "IT Assets",
                tabServers: "Servers Status",
                colID: "Ticket #",
                colSubject: "Subject",
                colUser: "User",
                colPriority: "Priority",
                colStatus: "Status",
                colAction: "Action",
                colAssetTag: "Serial/Tag",
                colType: "Type",
                colModel: "Model",
                modTicketTitle: "New Ticket",
                lblSubject: "Subject",
                lblCategory: "Category",
                lblPriority: "Priority",
                lblDetails: "Details",
                modAssetTitle: "Add Asset",
                lblType: "Type",
                lblModel: "Model",
                lblTag: "Asset Tag",
                lblUser: "Assign To",
                btnCancel: "Cancel",
                btnSubmit: "Submit",
                btnSave: "Save"
            }
        };
    </script>
</body>
</html>
