<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#FB4747">
    <title data-i18n="pageTitle">Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ© | AndroGov</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        brandRed: '#FB4747',
                        brandBlue: '#4267B2',
                        brandDark: '#1E293B',
                        brandGray: '#F8FAFC'
                    },
                    fontFamily: {
                        sans: ['Tajawal', 'Inter', 'sans-serif'],
                        en: ['Inter', 'sans-serif']
                    }
                }
            }
        }
    </script>

    <style>
        /* Custom Scrollbar for Chat */
        .chat-scroll::-webkit-scrollbar { width: 5px; }
        .chat-scroll::-webkit-scrollbar-track { background: transparent; }
        .chat-scroll::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 20px; }
        .dark .chat-scroll::-webkit-scrollbar-thumb { background-color: #475569; }

        /* Loading Overlay */
        .loading-overlay {
            position: fixed; inset: 0; background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(5px);
            z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 1rem;
        }
        .dark .loading-overlay { background: rgba(15, 23, 42, 0.9); }
        .loading-overlay.hidden { display: none; }
        .spinner {
            width: 48px; height: 48px; border: 5px solid rgba(66, 103, 178, 0.1);
            border-top-color: #4267B2; border-radius: 50%; animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-brandGray dark:bg-slate-900 text-slate-800 dark:text-slate-100 font-sans transition-colors duration-300">

    <div id="loadingOverlay" class="loading-overlay">
        <div class="spinner"></div>
        <p class="text-sm font-bold text-slate-600 dark:text-slate-300">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª...</p>
    </div>

    <div id="sidebar-container"></div>
    
    <div class="main-content-wrapper ltr:md:ml-72 rtl:md:mr-72 transition-all duration-300 flex flex-col min-h-screen h-screen overflow-hidden">
        <div id="header-container"></div>

        <main class="flex-1 p-4 h-[calc(100vh-80px)] overflow-hidden">
            
            <div class="flex h-full bg-white dark:bg-slate-800 rounded-3xl shadow-sm border border-slate-100 dark:border-slate-700 overflow-hidden">
                
                <div class="w-80 border-l rtl:border-l rtl:border-r-0 ltr:border-r ltr:border-l-0 border-slate-100 dark:border-slate-700 flex flex-col hidden md:flex">
                    <div class="p-4 border-b border-slate-100 dark:border-slate-700">
                        <div class="relative">
                            <input type="text" data-i18n-placeholder="plhSearch" placeholder="Ø¨Ø­Ø« Ø¹Ù† Ù…ÙˆØ¸Ù Ø£Ùˆ Ù…Ø¬Ù…ÙˆØ¹Ø©..." class="w-full bg-slate-50 dark:bg-slate-700 border-none rounded-xl py-2.5 pr-10 pl-4 text-sm focus:ring-2 focus:ring-brandBlue outline-none dark:text-white">
                            <i class="fa-solid fa-search absolute top-3 right-3 text-slate-400"></i>
                        </div>
                    </div>

                    <div class="flex-1 overflow-y-auto chat-scroll p-2 space-y-1">
                        
                        <div class="p-3 bg-blue-50 dark:bg-blue-900/20 rounded-xl cursor-pointer hover:bg-blue-100 dark:hover:bg-blue-900/30 transition">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-full bg-brandBlue text-white flex items-center justify-center shrink-0">
                                    <i class="fa-solid fa-users"></i>
                                </div>
                                <div class="flex-1 min-w-0">
                                    <div class="flex justify-between items-center mb-1">
                                        <h4 class="font-bold text-sm text-slate-800 dark:text-white truncate" data-i18n="grpExec">Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠØ©</h4>
                                        <span class="text-[10px] text-slate-400">10:30</span>
                                    </div>
                                    <p class="text-xs text-slate-500 dark:text-slate-400 truncate"><span class="font-bold text-brandBlue">CEO:</span> <span data-i18n="msgPreview1">Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø§Ø·Ù„Ø§Ø¹ Ø¹Ù„Ù‰ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø±ÙÙ‚...</span></p>
                                </div>
                            </div>
                        </div>

                        <div class="p-3 hover:bg-slate-50 dark:hover:bg-slate-700/50 rounded-xl cursor-pointer transition">
                            <div class="flex items-center gap-3">
                                <div class="relative">
                                    <img src="../photo/cfo.jpg" class="w-10 h-10 rounded-full object-cover" onerror="this.src='https://ui-avatars.com/api/?name=M&background=random'">
                                    <span class="absolute bottom-0 right-0 w-2.5 h-2.5 bg-green-500 border-2 border-white dark:border-slate-800 rounded-full"></span>
                                </div>
                                <div class="flex-1 min-w-0">
                                    <div class="flex justify-between items-center mb-1">
                                        <h4 class="font-bold text-sm text-slate-800 dark:text-white truncate">Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¨Ø®ÙŠØªÙŠ (CFO)</h4>
                                        <span class="text-[10px] text-slate-400">09:15</span>
                                    </div>
                                    <p class="text-xs text-slate-500 dark:text-slate-400 truncate" data-i18n="msgPreview2">ØªÙ… ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø±ÙˆØ§ØªØ¨ Ø¨Ù†Ø¬Ø§Ø­.</p>
                                </div>
                                <span class="bg-brandRed text-white text-[10px] w-5 h-5 flex items-center justify-center rounded-full font-bold">2</span>
                            </div>
                        </div>

                        <div class="p-3 hover:bg-slate-50 dark:hover:bg-slate-700/50 rounded-xl cursor-pointer transition">
                            <div class="flex items-center gap-3">
                                <div class="relative">
                                    <img src="../photo/hr.JPG" class="w-10 h-10 rounded-full object-cover" onerror="this.src='https://ui-avatars.com/api/?name=H&background=random'">
                                    <span class="absolute bottom-0 right-0 w-2.5 h-2.5 bg-slate-400 border-2 border-white dark:border-slate-800 rounded-full"></span>
                                </div>
                                <div class="flex-1 min-w-0">
                                    <div class="flex justify-between items-center mb-1">
                                        <h4 class="font-bold text-sm text-slate-800 dark:text-white truncate">Ù‡Ø§Ø¯ÙŠ Ø£Ø­Ù…Ø¯ (HR)</h4>
                                        <span class="text-[10px] text-slate-400">Ø£Ù…Ø³</span>
                                    </div>
                                    <p class="text-xs text-slate-500 dark:text-slate-400 truncate" data-i18n="msgPreview3">Ø¨Ø®ØµÙˆØµ Ø¥Ø¬Ø§Ø²Ø© Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ø¬Ø¯ÙŠØ¯...</p>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

                <div class="flex-1 flex flex-col bg-slate-50/50 dark:bg-slate-800/50">
                    
                    <div class="h-16 px-6 border-b border-slate-100 dark:border-slate-700 flex justify-between items-center bg-white dark:bg-slate-800">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-full bg-brandBlue text-white flex items-center justify-center font-bold text-lg">
                                <i class="fa-solid fa-users"></i>
                            </div>
                            <div>
                                <h3 class="font-bold text-slate-800 dark:text-white text-sm" data-i18n="grpExec">Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠØ©</h3>
                                <p class="text-xs text-green-500 flex items-center gap-1"><span class="w-1.5 h-1.5 rounded-full bg-green-500"></span> <span data-i18n="statusOnline">5 Ù…ØªØµÙ„ÙŠÙ† Ø§Ù„Ø¢Ù†</span></p>
                            </div>
                        </div>
                        <div class="flex gap-2 text-slate-400">
                            <button class="w-8 h-8 rounded-full hover:bg-slate-100 dark:hover:bg-slate-700 flex items-center justify-center transition"><i class="fa-solid fa-phone"></i></button>
                            <button class="w-8 h-8 rounded-full hover:bg-slate-100 dark:hover:bg-slate-700 flex items-center justify-center transition"><i class="fa-solid fa-video"></i></button>
                            <button class="w-8 h-8 rounded-full hover:bg-slate-100 dark:hover:bg-slate-700 flex items-center justify-center transition"><i class="fa-solid fa-circle-info"></i></button>
                        </div>
                    </div>

                    <div class="flex-1 overflow-y-auto chat-scroll p-6 space-y-6" id="messagesContainer">
                        
                        <div class="flex justify-center">
                            <span class="text-[10px] text-slate-400 bg-slate-100 dark:bg-slate-700 px-3 py-1 rounded-full" data-i18n="lblToday">Ø§Ù„ÙŠÙˆÙ…</span>
                        </div>

                        <div class="flex items-end gap-3">
                            <img src="../photo/ceo.jpeg" class="w-8 h-8 rounded-full object-cover mb-1 border border-white shadow-sm" onerror="this.src='https://ui-avatars.com/api/?name=H&background=random'">
                            <div class="max-w-[75%]">
                                <p class="text-[10px] text-slate-500 mb-1 mr-1 rtl:mr-1 ltr:ml-1">Hesham Al-Sohaibani</p>
                                <div class="bg-white dark:bg-slate-700 p-3 rounded-2xl rounded-br-none shadow-sm text-sm text-slate-700 dark:text-slate-200">
                                    <p data-i18n="msg1">Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…ØŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù† Ø§Ù„Ø¬Ù…ÙŠØ¹ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø±ÙÙ‚ Ù‚Ø¨Ù„ Ø§Ø¬ØªÙ…Ø§Ø¹ Ø§Ù„ØºØ¯.</p>
                                </div>
                                <span class="text-[10px] text-slate-400 mt-1 block">10:30 AM</span>
                            </div>
                        </div>

                        <div class="flex items-end gap-3">
                            <img src="../photo/ceo.jpeg" class="w-8 h-8 rounded-full object-cover mb-1 border border-white shadow-sm" onerror="this.src='https://ui-avatars.com/api/?name=H&background=random'">
                            <div class="max-w-[75%]">
                                <div class="bg-white dark:bg-slate-700 p-3 rounded-2xl rounded-br-none shadow-sm text-sm border border-slate-100 dark:border-slate-600 flex items-center gap-3 cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-600 transition">
                                    <div class="w-10 h-10 bg-red-50 text-red-500 rounded-lg flex items-center justify-center text-xl"><i class="fa-solid fa-file-pdf"></i></div>
                                    <div>
                                        <p class="font-bold text-slate-800 dark:text-white text-xs">Financial_Report_Q4.pdf</p>
                                        <p class="text-[10px] text-slate-400">2.4 MB</p>
                                    </div>
                                    <i class="fa-solid fa-download text-slate-400 ml-2"></i>
                                </div>
                                <span class="text-[10px] text-slate-400 mt-1 block">10:31 AM</span>
                            </div>
                        </div>

                        <div class="flex items-end gap-3 flex-row-reverse">
                            <img id="myChatAvatar" src="" class="w-8 h-8 rounded-full object-cover mb-1 border border-white shadow-sm" onerror="this.src='https://ui-avatars.com/api/?name=ME&background=random'">
                            <div class="max-w-[75%]">
                                <div class="bg-brandBlue p-3 rounded-2xl rounded-bl-none shadow-sm text-sm text-white">
                                    <p data-i18n="msg2">ÙˆØ¹Ù„ÙŠÙƒÙ… Ø§Ù„Ø³Ù„Ø§Ù…ØŒ ØªÙ… Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… ÙˆØ³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù‚Ø±ÙŠØ¨Ø§Ù‹.</p>
                                </div>
                                <div class="flex items-center justify-end gap-1 mt-1">
                                    <span class="text-[10px] text-slate-400">10:35 AM</span>
                                    <i class="fa-solid fa-check-double text-blue-500 text-[10px]"></i>
                                </div>
                            </div>
                        </div>

                    </div>

                    <div class="p-4 bg-white dark:bg-slate-800 border-t border-slate-100 dark:border-slate-700">
                        <div class="flex items-end gap-2 bg-slate-50 dark:bg-slate-700/50 p-2 rounded-2xl border border-slate-200 dark:border-slate-600">
                            <button class="w-10 h-10 rounded-xl hover:bg-slate-200 dark:hover:bg-slate-600 text-slate-400 transition flex items-center justify-center">
                                <i class="fa-solid fa-paperclip"></i>
                            </button>
                            <textarea id="chatInput" rows="1" class="flex-1 bg-transparent border-none outline-none py-2.5 px-2 text-sm max-h-32 resize-none custom-scroll dark:text-white" data-i18n-placeholder="plhType" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§..."></textarea>
                            <button class="w-10 h-10 rounded-xl hover:bg-slate-200 dark:hover:bg-slate-600 text-slate-400 transition flex items-center justify-center">
                                <i class="fa-regular fa-face-smile"></i>
                            </button>
                            <button onclick="sendMessage()" class="w-10 h-10 rounded-xl bg-brandBlue hover:bg-blue-700 text-white shadow-md transition flex items-center justify-center">
                                <i class="fa-solid fa-paper-plane rtl:rotate-180"></i>
                            </button>
                        </div>
                    </div>

                </div>
            </div>

        </main>
    </div>

    <script src="data/company_policy.js"></script>
    <script src="js/core/config.js"></script>
    <script src="js/core/i18n.js"></script>
    <script src="js/helpers/policy-helpers.js"></script>
    <script src="js/services/data-service.js"></script>
    <script src="js/components/role-switcher.js"></script>
    <script src="js/components/layout.js"></script>
    <script src="js/components/bot.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const checkSystem = setInterval(() => {
                if (typeof Layout !== 'undefined' && typeof AppConfig !== 'undefined' && typeof DataService !== 'undefined') {
                    clearInterval(checkSystem);
                    
                    if (!AppConfig.getCurrentUser()) {
                        const defaultUser = DataService.getUserById('USR_004') || DataService.getUsers()[0];
                        if (defaultUser) {
                            AppConfig.setCurrentUser(defaultUser);
                        }
                    }

                    Layout.init();
                    document.getElementById('loadingOverlay')?.classList.add('hidden');
                    initPage();
                }
            }, 50);
        });

        function initPage() {
            // 1. Translate
            updatePageLanguage();

            // 2. Set My Avatar
            const user = AppConfig.getCurrentUser();
            if (user) {
                // Fix relative path
                let avatarPath = user.avatar || '';
                if(avatarPath && !avatarPath.startsWith('http') && !avatarPath.startsWith('../')) {
                     avatarPath = '../' + avatarPath;
                }
                document.getElementById('myChatAvatar').src = avatarPath || 'https://ui-avatars.com/api/?name=' + (user.displayName || 'Me') + '&background=random';
            }

            // 3. Auto-scroll to bottom
            const container = document.getElementById('messagesContainer');
            container.scrollTop = container.scrollHeight;
        }

        function updatePageLanguage() {
            const lang = AppConfig.getLang();
            const dict = t[lang];
            
            document.documentElement.lang = lang;
            document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';

            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if(dict[key]) el.innerText = dict[key];
            });

            document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
                const key = el.getAttribute('data-i18n-placeholder');
                if(dict[key]) el.placeholder = dict[key];
            });
        }

        function sendMessage() {
            const input = document.getElementById('chatInput');
            const text = input.value.trim();
            if (!text) return;

            const container = document.getElementById('messagesContainer');
            const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            const user = AppConfig.getCurrentUser();
            let avatarPath = user?.avatar || '';
            if(avatarPath && !avatarPath.startsWith('http') && !avatarPath.startsWith('../')) {
                 avatarPath = '../' + avatarPath;
            }

            const msgHTML = `
                <div class="flex items-end gap-3 flex-row-reverse animate-pulse">
                    <img src="${avatarPath}" class="w-8 h-8 rounded-full object-cover mb-1 border border-white shadow-sm" onerror="this.src='https://ui-avatars.com/api/?name=ME&background=random'">
                    <div class="max-w-[75%]">
                        <div class="bg-brandBlue p-3 rounded-2xl rounded-bl-none shadow-sm text-sm text-white">
                            <p>${text}</p>
                        </div>
                        <div class="flex items-center justify-end gap-1 mt-1">
                            <span class="text-[10px] text-slate-400">${time}</span>
                            <i class="fa-regular fa-clock text-slate-400 text-[10px]"></i>
                        </div>
                    </div>
                </div>
            `;

            container.insertAdjacentHTML('beforeend', msgHTML);
            input.value = '';
            container.scrollTop = container.scrollHeight;

            // Simulate reply
            setTimeout(() => {
                const replyHTML = `
                    <div class="flex items-end gap-3">
                        <img src="../photo/ceo.jpeg" class="w-8 h-8 rounded-full object-cover mb-1 border border-white shadow-sm">
                        <div class="max-w-[75%]">
                            <div class="bg-white dark:bg-slate-700 p-3 rounded-2xl rounded-br-none shadow-sm text-sm text-slate-700 dark:text-slate-200">
                                <p>ğŸ‘</p>
                            </div>
                            <span class="text-[10px] text-slate-400 mt-1 block">${time}</span>
                        </div>
                    </div>
                `;
                container.insertAdjacentHTML('beforeend', replyHTML);
                container.scrollTop = container.scrollHeight;
            }, 1000);
        }

        // --- Translation Dictionary ---
        const t = {
            ar: {
                pageTitle: "Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ© | AndroGov",
                plhSearch: "Ø¨Ø­Ø« Ø¹Ù† Ù…ÙˆØ¸Ù Ø£Ùˆ Ù…Ø¬Ù…ÙˆØ¹Ø©...",
                grpExec: "Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠØ©",
                statusOnline: "5 Ù…ØªØµÙ„ÙŠÙ† Ø§Ù„Ø¢Ù†",
                msgPreview1: "Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø§Ø·Ù„Ø§Ø¹ Ø¹Ù„Ù‰ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø±ÙÙ‚...",
                msgPreview2: "ØªÙ… ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø±ÙˆØ§ØªØ¨ Ø¨Ù†Ø¬Ø§Ø­.",
                msgPreview3: "Ø¨Ø®ØµÙˆØµ Ø¥Ø¬Ø§Ø²Ø© Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ø¬Ø¯ÙŠØ¯...",
                lblToday: "Ø§Ù„ÙŠÙˆÙ…",
                msg1: "Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…ØŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù† Ø§Ù„Ø¬Ù…ÙŠØ¹ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø±ÙÙ‚ Ù‚Ø¨Ù„ Ø§Ø¬ØªÙ…Ø§Ø¹ Ø§Ù„ØºØ¯.",
                msg2: "ÙˆØ¹Ù„ÙŠÙƒÙ… Ø§Ù„Ø³Ù„Ø§Ù…ØŒ ØªÙ… Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… ÙˆØ³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù‚Ø±ÙŠØ¨Ø§Ù‹.",
                plhType: "Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§..."
            },
            en: {
                pageTitle: "Internal Chat | AndroGov",
                plhSearch: "Search employee or group...",
                grpExec: "Executive Management",
                statusOnline: "5 Online Now",
                msgPreview1: "Please check the attached report...",
                msgPreview2: "Salaries processed successfully.",
                msgPreview3: "Regarding the new employee leave...",
                lblToday: "Today",
                msg1: "Hi all, please review the attached financial report before tomorrow's meeting.",
                msg2: "Received. Will send feedback shortly.",
                plhType: "Type your message here..."
            }
        };
    </script>
</body>
</html>
