<!DOCTYPE html>
<html lang="ar" dir="rtl" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>إدارة المستخدمين | eGov System</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../assets/css/style.css">

    <style>
        /* =========================================
           تنسيقات خاصة بهذه الصفحة فقط (لا تنقلها)
           ========================================= */
        
        /* شريط التبويبات */
        .tab-container { display: flex; gap: 15px; margin-bottom: 25px; border-bottom: 1px solid var(--border-color); padding-bottom: 15px; }
        .tab-btn {
            background: transparent; border: none; color: var(--text-secondary); font-size: 14px; font-weight: bold;
            padding: 10px 20px; cursor: pointer; border-radius: 10px; transition: 0.3s;
        }
        .tab-btn.active { background: var(--bg-elevated); color: var(--secondary-color); }
        .tab-btn:hover { color: var(--text-primary); }

        /* تخطيط صفحة الصلاحيات */
        .roles-layout { display: grid; grid-template-columns: 260px 1fr; gap: 25px; height: calc(100vh - 250px); }
        .roles-list { background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 16px; overflow-y: auto; height: 100%; }
        .role-item { padding: 15px 20px; border-bottom: 1px solid var(--border-color); cursor: pointer; display: flex; justify-content: space-between; align-items: center; color: var(--text-secondary); transition: 0.2s; }
        .role-item:hover { background: var(--bg-elevated); }
        .role-item.active { background: rgba(91, 192, 248, 0.1); color: var(--secondary-color); border-right: 3px solid var(--secondary-color); }
        
        /* تنسيق المودال (النوافذ المنبثقة) */
        .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 2000; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
        .modal-box { background: var(--bg-secondary); width: 500px; padding: 30px; border-radius: 20px; border: 1px solid var(--border-color); animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .form-label { display: block; margin-bottom: 8px; color: var(--text-secondary); font-size: 13px; }
        .form-input, .form-select { width: 100%; padding: 10px; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary); outline: none; }
        
        /* ألوان الأدوار */
        .role-badge { padding: 4px 12px; border-radius: 20px; font-size: 11px; font-weight: bold; }
        .role-admin { background: rgba(139, 127, 255, 0.15); color: var(--primary-color); }
        .role-manager { background: rgba(91, 192, 248, 0.15); color: var(--secondary-color); }
        .role-user { background: rgba(126, 221, 163, 0.15); color: var(--success-color); }

        /* سويتش التفعيل */
        .switch { position: relative; display: inline-block; width: 40px; height: 20px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 20px; }
        .slider:before { position: absolute; content: ""; height: 14px; width: 14px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--success-color); }
        input:checked + .slider:before { transform: translateX(20px); }
    </style>
</head>
<body>

    <div class="sidebar-overlay" id="sidebarOverlay" onclick="Layout.toggleSidebar()"></div>

    <div id="userModal" class="modal-overlay">
        <div class="modal-box">
            <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
                <h3 id="modalTitle" style="margin:0; color:var(--text-primary);">إضافة مستخدم جديد</h3>
                <i class="fas fa-times" onclick="closeModal('userModal')" style="cursor:pointer; color:var(--text-secondary);"></i>
            </div>
            <input type="hidden" id="editRowId">
            <div class="form-row">
                <div style="margin-bottom:15px;">
                    <label class="form-label">الاسم الكامل</label>
                    <input type="text" id="modalName" class="form-input">
                </div>
                <div style="margin-bottom:15px;">
                    <label class="form-label">البريد الإلكتروني</label>
                    <input type="email" id="modalEmail" class="form-input">
                </div>
            </div>
            <div style="margin-bottom:20px;">
                <label class="form-label">الدور الوظيفي</label>
                <select id="modalRole" class="form-select">
                    <option value="الرئيس التنفيذي">الرئيس التنفيذي</option>
                    <option value="مدير النظام">مدير النظام</option>
                    <option value="مدير مالي">مدير مالي</option>
                    <option value="مساهم">مساهم</option>
                </select>
            </div>
            <div style="display:flex; justify-content:flex-end; gap:10px;">
                <button onclick="closeModal('userModal')" style="background:transparent; border:1px solid var(--border-color); color:var(--text-primary); padding:8px 16px; border-radius:8px; cursor:pointer;">إلغاء</button>
                <button onclick="saveUser()" style="background:var(--primary-color); color:#fff; border:none; padding:8px 20px; border-radius:8px; cursor:pointer;">حفظ</button>
            </div>
        </div>
    </div>

    <div class="app-container">
        
        <aside id="appSidebar" class="sidebar"></aside>

        <div class="main-content">
            
            <header id="appTopbar" class="topbar"></header>

            <main class="dashboard-content fade-in" id="workspace">
                
                <div class="tab-container">
                    <button class="tab-btn active" onclick="switchTab('users')" id="tab-users-btn">
                        <i class="fas fa-users"></i> <span data-i18n="tab_users">إدارة المستخدمين</span>
                    </button>
                    <button class="tab-btn" onclick="switchTab('roles')" id="tab-roles-btn">
                        <i class="fas fa-shield-alt"></i> <span data-i18n="tab_roles">هيكل الصلاحيات</span>
                    </button>
                </div>

                <div id="users-view">
                    <div class="stats-grid">
                        <div class="stat-card" style="padding:15px; display:flex; align-items:center; gap:15px;">
                            <div style="width:50px; height:50px; border-radius:12px; background:rgba(91,192,248,0.1); color:var(--secondary-color); display:flex; align-items:center; justify-content:center; font-size:20px;"><i class="fas fa-users"></i></div>
                            <div><h4 style="margin:0; font-size:24px;">25</h4><span style="font-size:12px; color:var(--text-secondary);">إجمالي المستخدمين</span></div>
                        </div>
                        <div class="stat-card" style="padding:15px; display:flex; align-items:center; gap:15px;">
                            <div style="width:50px; height:50px; border-radius:12px; background:rgba(126,221,163,0.1); color:var(--success-color); display:flex; align-items:center; justify-content:center; font-size:20px;"><i class="fas fa-user-check"></i></div>
                            <div><h4 style="margin:0; font-size:24px;">11</h4><span style="font-size:12px; color:var(--text-secondary);">نشط حالياً</span></div>
                        </div>
                        <div class="stat-card" style="padding:15px; display:flex; align-items:center; gap:15px;">
                            <div style="width:50px; height:50px; border-radius:12px; background:rgba(139,127,255,0.1); color:var(--primary-color); display:flex; align-items:center; justify-content:center; font-size:20px;"><i class="fas fa-user-shield"></i></div>
                            <div><h4 style="margin:0; font-size:24px;">3</h4><span style="font-size:12px; color:var(--text-secondary);">مدراء النظام</span></div>
                        </div>
                    </div>

                    <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                        <input type="text" id="userSearch" class="form-input" style="width: 300px;" placeholder="بحث..." onkeyup="filterUsers()">
                        <button onclick="openModal('userModal', 'add')" style="background:var(--primary-color); color:#fff; border:none; padding:10px 20px; border-radius:8px; cursor:pointer;">
                            <i class="fas fa-plus"></i> مستخدم جديد
                        </button>
                    </div>

                    <div class="section-card" style="padding:0; overflow:hidden;">
                        <div class="table-responsive">
                            <table class="table" id="usersTable">
                                <thead>
                                    <tr>
                                        <th>المستخدم</th>
                                        <th>الدور الوظيفي</th>
                                        <th>القسم</th>
                                        <th>تاريخ الانضمام</th>
                                        <th>الحالة</th>
                                        <th>إجراءات</th>
                                    </tr>
                                </thead>
                                <tbody id="usersTableBody">
                                    <tr id="row-1">
                                        <td><div style="display:flex; align-items:center; gap:10px;"><div style="width:35px; height:35px; border-radius:50%; background:#334155;"></div><div><span style="display:block; font-weight:bold;">معتز سعود</span><span style="font-size:11px; color:var(--text-secondary);">ceo@ecode.sa</span></div></div></td>
                                        <td><span class="role-badge role-admin">الرئيس التنفيذي</span></td>
                                        <td>الإدارة العليا</td>
                                        <td>2025-01-01</td>
                                        <td><span class="badge" style="background:rgba(126,221,163,0.15); color:var(--success-color); padding:4px 10px; border-radius:12px; font-size:11px;">نشط</span></td>
                                        <td>
                                            <button onclick="editUser(this)" style="background:none; border:none; color:var(--text-secondary); cursor:pointer; margin-left:5px;"><i class="fas fa-edit"></i></button>
                                            <button onclick="deleteUser(this)" style="background:none; border:none; color:var(--danger-color); cursor:pointer;"><i class="fas fa-trash"></i></button>
                                        </td>
                                    </tr>
                                    <tr id="row-2">
                                        <td><div style="display:flex; align-items:center; gap:10px;"><div style="width:35px; height:35px; border-radius:50%; background:#334155;"></div><div><span style="display:block; font-weight:bold;">أيمن المغربي</span><span style="font-size:11px; color:var(--text-secondary);">admin@ecode.sa</span></div></div></td>
                                        <td><span class="role-badge role-admin">مدير النظام</span></td>
                                        <td>تقنية المعلومات</td>
                                        <td>2025-01-05</td>
                                        <td><span class="badge" style="background:rgba(126,221,163,0.15); color:var(--success-color); padding:4px 10px; border-radius:12px; font-size:11px;">نشط</span></td>
                                        <td>
                                            <button onclick="editUser(this)" style="background:none; border:none; color:var(--text-secondary); cursor:pointer; margin-left:5px;"><i class="fas fa-edit"></i></button>
                                            <button onclick="deleteUser(this)" style="background:none; border:none; color:var(--danger-color); cursor:pointer;"><i class="fas fa-trash"></i></button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div id="roles-view" style="display:none;">
                    <div class="roles-layout">
                        <div class="roles-list">
                            <div class="role-item active" onclick="selectRole(this, 'ceo')"><span>الرئيس التنفيذي</span> <i class="fas fa-chevron-left"></i></div>
                            <div class="role-item" onclick="selectRole(this, 'cfo')"><span>المدير المالي</span> <i class="fas fa-chevron-left"></i></div>
                            <div class="role-item" onclick="selectRole(this, 'hr')"><span>مدير الموارد</span> <i class="fas fa-chevron-left"></i></div>
                            <div class="role-item" onclick="selectRole(this, 'it')"><span>مدير التقنية</span> <i class="fas fa-chevron-left"></i></div>
                        </div>
                        
                        <div class="section-card">
                            <h2 id="selectedRoleTitle" style="color:var(--secondary-color); margin-bottom:20px;">صلاحيات: الرئيس التنفيذي</h2>
                            
                            <div style="margin-bottom:20px; border-bottom:1px solid var(--border-color); padding-bottom:20px;">
                                <h4 style="margin-bottom:15px;"><i class="fas fa-coins" style="color:var(--warning-color);"></i> الصلاحيات المالية</h4>
                                <div style="background:var(--bg-primary); padding:15px; border-radius:12px; border:1px solid var(--border-color);">
                                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                                        <span>تفعيل الاعتماد المباشر للطلبات الأقل من:</span>
                                        <input type="number" value="50000" class="form-input" style="width:100px; text-align:center;">
                                    </div>
                                    <small style="color:var(--text-muted)">* الطلبات الأعلى من هذا الحد تتطلب موافقة مجلس الإدارة.</small>
                                </div>
                            </div>

                            <div style="margin-bottom:20px;">
                                <h4 style="margin-bottom:15px;"><i class="fas fa-users-cog" style="color:var(--secondary-color);"></i> الإدارة والمستخدمين</h4>
                                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; padding:10px; background:var(--bg-primary); border-radius:8px;">
                                    <span>إضافة مستخدمين جدد</span>
                                    <label class="switch"><input type="checkbox" checked><span class="slider"></span></label>
                                </div>
                                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; padding:10px; background:var(--bg-primary); border-radius:8px;">
                                    <span>حذف حسابات</span>
                                    <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                                </div>
                            </div>

                            <button onclick="alert('تم حفظ الصلاحيات بنجاح!')" style="width:100%; background:var(--primary-color); color:#fff; border:none; padding:12px; border-radius:8px; cursor:pointer;">حفظ التغييرات</button>
                        </div>
                    </div>
                </div>

            </main>
        </div>
    </div>

    <script src="../assets/js/core/i18n.js"></script>
    <script src="../assets/js/layout.js"></script>
    <script src="../assets/js/components/bot.js"></script>
    <script src="../assets/js/system.js"></script>

    <script>
        // --- دوال الصفحة المحلية (Tab & Modal Logic) ---
        
        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('tab-' + tab + '-btn').classList.add('active');
            
            document.getElementById('users-view').style.display = tab === 'users' ? 'block' : 'none';
            document.getElementById('roles-view').style.display = tab === 'roles' ? 'block' : 'none';
        }

        function openModal(id, mode) {
            document.getElementById(id).style.display = 'flex';
            if(mode === 'add') {
                document.getElementById('modalTitle').innerText = "إضافة مستخدم جديد";
                document.getElementById('modalName').value = '';
                document.getElementById('modalEmail').value = '';
            }
        }

        function closeModal(id) {
            document.getElementById(id).style.display = 'none';
        }

        function saveUser() {
            // هنا تضع كود الحفظ الحقيقي (AJAX/Fetch)
            alert('تم الحفظ بنجاح (محاكاة)');
            closeModal('userModal');
        }

        function editUser(btn) {
            openModal('userModal', 'edit');
            document.getElementById('modalTitle').innerText = "تعديل المستخدم";
            document.getElementById('modalName').value = "مستخدم تجريبي";
            document.getElementById('modalEmail').value = "demo@ecode.sa";
        }

        function deleteUser(btn) {
            if(confirm('هل أنت متأكد من حذف هذا المستخدم؟')) {
                btn.closest('tr').style.opacity = '0.3';
            }
        }

        function selectRole(el, role) {
            document.querySelectorAll('.role-item').forEach(i => i.classList.remove('active'));
            el.classList.add('active');
            document.getElementById('selectedRoleTitle').innerText = "صلاحيات: " + el.querySelector('span').innerText;
        }

        function filterUsers() {
            let input = document.getElementById('userSearch').value.toLowerCase();
            let rows = document.querySelectorAll('#usersTableBody tr');
            rows.forEach(row => {
                let text = row.innerText.toLowerCase();
                row.style.display = text.includes(input) ? '' : 'none';
            });
        }
    </script>

</body>
</html>
