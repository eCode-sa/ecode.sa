<!DOCTYPE html>
<html lang="ar" dir="rtl" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>إدارة المستخدمين | eGov System</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../assets/css/style.css">

    <style>
        /* تنسيقات خاصة للصفحة */
        .tab-container { display: flex; gap: 15px; margin-bottom: 25px; border-bottom: 1px solid var(--border-color); padding-bottom: 15px; }
        .tab-btn { background: transparent; border: none; color: var(--text-secondary); font-size: 14px; font-weight: bold; padding: 10px 20px; cursor: pointer; border-radius: 10px; transition: 0.3s; }
        .tab-btn.active { background: var(--bg-elevated); color: var(--secondary-color); }
        .tab-btn:hover { color: var(--text-primary); }

        .roles-layout { display: grid; grid-template-columns: 260px 1fr; gap: 25px; height: calc(100vh - 250px); }
        .roles-list { background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 16px; display: flex; flex-direction: column; overflow: hidden; height: 100%; }
        .role-item { padding: 15px 20px; border-bottom: 1px solid var(--border-color); cursor: pointer; display: flex; justify-content: space-between; align-items: center; color: var(--text-secondary); transition: 0.2s; }
        .role-item:hover { background: var(--bg-elevated); }
        .role-item.active { background: rgba(91, 192, 248, 0.1); color: var(--secondary-color); border-right: 3px solid var(--secondary-color); }
        .add-new-role { margin-top: auto; border-top: 1px solid var(--border-color); color: var(--success-color) !important; font-weight: bold; background: rgba(126, 221, 163, 0.05); }
        .add-new-role:hover { background: rgba(126, 221, 163, 0.1); }

        .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 2000; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
        .modal-box { background: var(--bg-secondary); width: 500px; padding: 30px; border-radius: 20px; border: 1px solid var(--border-color); animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .form-label { display: block; margin-bottom: 8px; color: var(--text-secondary); font-size: 13px; }
        .form-input, .form-select { width: 100%; padding: 10px; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary); outline: none; }
        
        .role-badge { padding: 4px 12px; border-radius: 20px; font-size: 11px; font-weight: bold; }
        .role-admin { background: rgba(139, 127, 255, 0.15); color: var(--primary-color); }
        .role-manager { background: rgba(91, 192, 248, 0.15); color: var(--secondary-color); }
        .role-user { background: rgba(126, 221, 163, 0.15); color: var(--success-color); }

        .switch { position: relative; display: inline-block; width: 40px; height: 20px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 20px; }
        .slider:before { position: absolute; content: ""; height: 14px; width: 14px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--success-color); }
        input:checked + .slider:before { transform: translateX(20px); }
    </style>
</head>
<body>

    <div class="sidebar-overlay" id="sidebarOverlay" onclick="Layout.toggleSidebar()"></div>

    <div id="userModal" class="modal-overlay">
        <div class="modal-box">
            <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
                <h3 id="modalTitle" style="margin:0; color:var(--text-primary);" data-i18n="modal_add_user">إضافة مستخدم جديد</h3>
                <i class="fas fa-times" onclick="closeModal('userModal')" style="cursor:pointer; color:var(--text-secondary);"></i>
            </div>
            <input type="hidden" id="editRowId">
            <div class="form-row">
                <div style="margin-bottom:15px;">
                    <label class="form-label" data-i18n="lbl_name">الاسم الكامل</label>
                    <input type="text" id="modalName" class="form-input">
                </div>
                <div style="margin-bottom:15px;">
                    <label class="form-label" data-i18n="lbl_email">البريد الإلكتروني</label>
                    <input type="email" id="modalEmail" class="form-input">
                </div>
            </div>
            <div style="margin-bottom:20px;">
                <label class="form-label" data-i18n="col_role">الدور الوظيفي</label>
                <select id="modalRole" class="form-select">
                    <option value="ceo" data-i18n="role_ceo">الرئيس التنفيذي</option>
                    <option value="admin" data-i18n="role_admin">مدير النظام</option>
                    <option value="cfo" data-i18n="role_cfo">مدير مالي</option>
                    <option value="shareholder" data-i18n="role_shareholder">مساهم</option>
                </select>
            </div>
            <div style="display:flex; justify-content:flex-end; gap:10px;">
                <button onclick="closeModal('userModal')" style="background:transparent; border:1px solid var(--border-color); color:var(--text-primary); padding:8px 16px; border-radius:8px; cursor:pointer;" data-i18n="btn_cancel">إلغاء</button>
                <button onclick="saveUser()" style="background:var(--primary-color); color:#fff; border:none; padding:8px 20px; border-radius:8px; cursor:pointer;" data-i18n="btn_save">حفظ</button>
            </div>
        </div>
    </div>

    <div id="addRoleModal" class="modal-overlay">
        <div class="modal-box">
            <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
                <h3 style="margin:0; color:var(--text-primary);" data-i18n="btn_add_role">إضافة وظيفة جديدة</h3>
                <i class="fas fa-times" onclick="closeModal('addRoleModal')" style="cursor:pointer; color:var(--text-secondary);"></i>
            </div>
            <div style="margin-bottom:15px;">
                <label class="form-label" data-i18n="lbl_role_name">اسم الوظيفة</label>
                <input type="text" id="newRoleName" class="form-input">
            </div>
            <div style="margin-bottom:20px;">
                <label class="form-label" data-i18n="col_dept">القسم</label>
                <input type="text" id="newDeptName" class="form-input">
            </div>
            <div style="display:flex; justify-content:flex-end; gap:10px;">
                <button onclick="closeModal('addRoleModal')" style="background:transparent; border:1px solid var(--border-color); color:var(--text-primary); padding:8px 16px; border-radius:8px; cursor:pointer;" data-i18n="btn_cancel">إلغاء</button>
                <button onclick="saveNewRole()" style="background:var(--primary-color); color:#fff; border:none; padding:8px 20px; border-radius:8px; cursor:pointer;" data-i18n="btn_create">إنشاء</button>
            </div>
        </div>
    </div>

    <div class="app-container">
        <aside id="appSidebar" class="sidebar"></aside>
        <div class="main-content">
            <header id="appTopbar" class="topbar"></header>
            <main class="dashboard-content fade-in" id="workspace">
                
                <div class="tab-container">
                    <button class="tab-btn active" onclick="switchTab('users')" id="tab-users-btn">
                        <i class="fas fa-users"></i> <span data-i18n="tab_users">إدارة المستخدمين</span>
                    </button>
                    <button class="tab-btn" onclick="switchTab('roles')" id="tab-roles-btn">
                        <i class="fas fa-shield-alt"></i> <span data-i18n="tab_roles">هيكل الصلاحيات</span>
                    </button>
                </div>

                <div id="users-view">
                    <div class="stats-grid">
                        <div class="stat-card" style="padding:15px; display:flex; align-items:center; gap:15px;">
                            <div style="width:50px; height:50px; border-radius:12px; background:rgba(91,192,248,0.1); color:var(--secondary-color); display:flex; align-items:center; justify-content:center; font-size:20px;"><i class="fas fa-users"></i></div>
                            <div><h4 style="margin:0; font-size:24px;">25</h4><span style="font-size:12px; color:var(--text-secondary);" data-i18n="stat_total">إجمالي المستخدمين</span></div>
                        </div>
                        <div class="stat-card" style="padding:15px; display:flex; align-items:center; gap:15px;">
                            <div style="width:50px; height:50px; border-radius:12px; background:rgba(126,221,163,0.1); color:var(--success-color); display:flex; align-items:center; justify-content:center; font-size:20px;"><i class="fas fa-user-check"></i></div>
                            <div><h4 style="margin:0; font-size:24px;">11</h4><span style="font-size:12px; color:var(--text-secondary);" data-i18n="stat_active">نشط حالياً</span></div>
                        </div>
                        <div class="stat-card" style="padding:15px; display:flex; align-items:center; gap:15px;">
                            <div style="width:50px; height:50px; border-radius:12px; background:rgba(139,127,255,0.1); color:var(--primary-color); display:flex; align-items:center; justify-content:center; font-size:20px;"><i class="fas fa-user-shield"></i></div>
                            <div><h4 style="margin:0; font-size:24px;">3</h4><span style="font-size:12px; color:var(--text-secondary);" data-i18n="stat_admins">مدراء النظام</span></div>
                        </div>
                        <div class="stat-card" style="padding:15px; display:flex; align-items:center; gap:15px;">
                            <div style="width:50px; height:50px; border-radius:12px; background:rgba(255,121,198,0.1); color:var(--danger-color); display:flex; align-items:center; justify-content:center; font-size:20px;"><i class="fas fa-user-lock"></i></div>
                            <div><h4 style="margin:0; font-size:24px;">0</h4><span style="font-size:12px; color:var(--text-secondary);" data-i18n="stat_blocked">محظورين</span></div>
                        </div>
                    </div>

                    <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                        <input type="text" id="userSearch" class="form-input" style="width: 300px;" placeholder="..." data-i18n="ph_search" onkeyup="filterUsers()">
                        <button onclick="openModal('userModal', 'add')" style="background:var(--primary-color); color:#fff; border:none; padding:10px 20px; border-radius:8px; cursor:pointer;">
                            <i class="fas fa-plus"></i> <span data-i18n="btn_add_user">مستخدم جديد</span>
                        </button>
                    </div>

                    <div class="section-card" style="padding:0; overflow:hidden;">
                        <div class="table-responsive">
                            <table class="table" id="usersTable">
                                <thead>
                                    <tr>
                                        <th data-i18n="col_user">المستخدم</th>
                                        <th data-i18n="col_role">الدور الوظيفي</th>
                                        <th data-i18n="col_dept">القسم</th>
                                        <th data-i18n="col_join">تاريخ الانضمام</th>
                                        <th data-i18n="col_status">الحالة</th>
                                        <th data-i18n="col_actions">إجراءات</th>
                                    </tr>
                                </thead>
                                <tbody id="usersTableBody">
                                    <tr id="row-1">
                                        <td><div style="display:flex; align-items:center; gap:10px;"><div style="width:35px; height:35px; border-radius:50%; background:#334155;"></div><div><span style="display:block; font-weight:bold;" data-i18n="name_mutaz">معتز سعود</span><span style="font-size:11px; color:var(--text-secondary);">ceo@ecode.sa</span></div></div></td>
                                        <td><span class="role-badge role-admin" data-i18n="role_ceo">الرئيس التنفيذي</span></td>
                                        <td data-i18n="dept_top">الإدارة العليا</td>
                                        <td>2025-01-01</td>
                                        <td><span class="badge" style="background:rgba(126,221,163,0.15); color:var(--success-color); padding:4px 10px; border-radius:12px; font-size:11px;" data-i18n="status_active">نشط</span></td>
                                        <td><button onclick="editUser(this)" style="background:none; border:none; color:var(--text-secondary); cursor:pointer;"><i class="fas fa-edit"></i></button></td>
                                    </tr>
                                    <tr id="row-2">
                                        <td><div style="display:flex; align-items:center; gap:10px;"><div style="width:35px; height:35px; border-radius:50%; background:#334155;"></div><div><span style="display:block; font-weight:bold;" data-i18n="name_ali">علي ابراهيم</span><span style="font-size:11px; color:var(--text-secondary);">chairman@ecode.sa</span></div></div></td>
                                        <td><span class="role-badge role-admin" data-i18n="role_board">رئيس المجلس</span></td>
                                        <td data-i18n="dept_board">مجلس الإدارة</td>
                                        <td>2025-01-01</td>
                                        <td><span class="badge" style="background:rgba(126,221,163,0.15); color:var(--success-color); padding:4px 10px; border-radius:12px; font-size:11px;" data-i18n="status_active">نشط</span></td>
                                        <td><button onclick="editUser(this)" style="background:none; border:none; color:var(--text-secondary); cursor:pointer;"><i class="fas fa-edit"></i></button></td>
                                    </tr>
                                    <tr id="row-3">
                                        <td><div style="display:flex; align-items:center; gap:10px;"><div style="width:35px; height:35px; border-radius:50%; background:#334155;"></div><div><span style="display:block; font-weight:bold;" data-i18n="name_ayman">أيمن المغربي</span><span style="font-size:11px; color:var(--text-secondary);">admin@ecode.sa</span></div></div></td>
                                        <td><span class="role-badge role-admin" data-i18n="role_admin">مدير النظام</span></td>
                                        <td data-i18n="dept_it">تقنية المعلومات</td>
                                        <td>2025-01-05</td>
                                        <td><span class="badge" style="background:rgba(126,221,163,0.15); color:var(--success-color); padding:4px 10px; border-radius:12px; font-size:11px;" data-i18n="status_active">نشط</span></td>
                                        <td><button onclick="editUser(this)" style="background:none; border:none; color:var(--text-secondary); cursor:pointer;"><i class="fas fa-edit"></i></button></td>
                                    </tr>
                                    <tr id="row-4">
                                        <td><div style="display:flex; align-items:center; gap:10px;"><div style="width:35px; height:35px; border-radius:50%; background:#334155;"></div><div><span style="display:block; font-weight:bold;" data-i18n="name_abdulaziz">عبدالعزيز سلطان</span><span style="font-size:11px; color:var(--text-secondary);">cto@ecode.sa</span></div></div></td>
                                        <td><span class="role-badge role-manager" data-i18n="role_cto">مدير التقنية</span></td>
                                        <td data-i18n="dept_it">تقنية المعلومات</td>
                                        <td>2025-02-01</td>
                                        <td><span class="badge" style="background:rgba(126,221,163,0.15); color:var(--success-color); padding:4px 10px; border-radius:12px; font-size:11px;" data-i18n="status_active">نشط</span></td>
                                        <td><button onclick="editUser(this)" style="background:none; border:none; color:var(--text-secondary); cursor:pointer;"><i class="fas fa-edit"></i></button></td>
                                    </tr>
                                    <tr id="row-5">
                                        <td><div style="display:flex; align-items:center; gap:10px;"><div style="width:35px; height:35px; border-radius:50%; background:#334155;"></div><div><span style="display:block; font-weight:bold;" data-i18n="name_ibrahim">ابراهيم اياد</span><span style="font-size:11px; color:var(--text-secondary);">cfo@ecode.sa</span></div></div></td>
                                        <td><span class="role-badge role-manager" data-i18n="role_cfo">المدير المالي</span></td>
                                        <td data-i18n="dept_finance">الإدارة المالية</td>
                                        <td>2025-02-15</td>
                                        <td><span class="badge" style="background:rgba(126,221,163,0.15); color:var(--success-color); padding:4px 10px; border-radius:12px; font-size:11px;" data-i18n="status_active">نشط</span></td>
                                        <td><button onclick="editUser(this)" style="background:none; border:none; color:var(--text-secondary); cursor:pointer;"><i class="fas fa-edit"></i></button></td>
                                    </tr>
                                    <tr id="row-6">
                                        <td><div style="display:flex; align-items:center; gap:10px;"><div style="width:35px; height:35px; border-radius:50%; background:#334155;"></div><div><span style="display:block; font-weight:bold;" data-i18n="name_ahmed">احمد عبد القادر</span><span style="font-size:11px; color:var(--text-secondary);">hr@ecode.sa</span></div></div></td>
                                        <td><span class="role-badge role-manager" data-i18n="role_hr">مدير الموارد</span></td>
                                        <td data-i18n="dept_hr">الموارد البشرية</td>
                                        <td>2025-03-01</td>
                                        <td><span class="badge" style="background:rgba(126,221,163,0.15); color:var(--success-color); padding:4px 10px; border-radius:12px; font-size:11px;" data-i18n="status_active">نشط</span></td>
                                        <td><button onclick="editUser(this)" style="background:none; border:none; color:var(--text-secondary); cursor:pointer;"><i class="fas fa-edit"></i></button></td>
                                    </tr>
                                    <tr id="row-7">
                                        <td><div style="display:flex; align-items:center; gap:10px;"><div style="width:35px; height:35px; border-radius:50%; background:#334155;"></div><div><span style="display:block; font-weight:bold;" data-i18n="name_amjad">امجاد علي</span><span style="font-size:11px; color:var(--text-secondary);">sales@ecode.sa</span></div></div></td>
                                        <td><span class="role-badge role-manager" data-i18n="role_sales">مدير المبيعات</span></td>
                                        <td data-i18n="dept_sales">المبيعات</td>
                                        <td>2025-03-20</td>
                                        <td><span class="badge" style="background:rgba(126,221,163,0.15); color:var(--success-color); padding:4px 10px; border-radius:12px; font-size:11px;" data-i18n="status_active">نشط</span></td>
                                        <td><button onclick="editUser(this)" style="background:none; border:none; color:var(--text-secondary); cursor:pointer;"><i class="fas fa-edit"></i></button></td>
                                    </tr>
                                    <tr id="row-8">
                                        <td><div style="display:flex; align-items:center; gap:10px;"><div style="width:35px; height:35px; border-radius:50%; background:#334155;"></div><div><span style="display:block; font-weight:bold;" data-i18n="name_inas">ايناس الطيب</span><span style="font-size:11px; color:var(--text-secondary);">audit@ecode.sa</span></div></div></td>
                                        <td><span class="role-badge role-user" data-i18n="role_audit">المدقق الداخلي</span></td>
                                        <td data-i18n="dept_audit">التدقيق</td>
                                        <td>2025-04-05</td>
                                        <td><span class="badge" style="background:rgba(126,221,163,0.15); color:var(--success-color); padding:4px 10px; border-radius:12px; font-size:11px;" data-i18n="status_active">نشط</span></td>
                                        <td><button onclick="editUser(this)" style="background:none; border:none; color:var(--text-secondary); cursor:pointer;"><i class="fas fa-edit"></i></button></td>
                                    </tr>
                                    <tr id="row-9">
                                        <td><div style="display:flex; align-items:center; gap:10px;"><div style="width:35px; height:35px; border-radius:50%; background:#334155;"></div><div><span style="display:block; font-weight:bold;" data-i18n="name_amal">امل خالد</span><span style="font-size:11px; color:var(--text-secondary);">secretary@ecode.sa</span></div></div></td>
                                        <td><span class="role-badge role-user" data-i18n="role_sec">أمين السر</span></td>
                                        <td data-i18n="dept_board">مجلس الإدارة</td>
                                        <td>2025-04-15</td>
                                        <td><span class="badge" style="background:rgba(126,221,163,0.15); color:var(--success-color); padding:4px 10px; border-radius:12px; font-size:11px;" data-i18n="status_active">نشط</span></td>
                                        <td><button onclick="editUser(this)" style="background:none; border:none; color:var(--text-secondary); cursor:pointer;"><i class="fas fa-edit"></i></button></td>
                                    </tr>
                                    <tr id="row-10">
                                        <td><div style="display:flex; align-items:center; gap:10px;"><div style="width:35px; height:35px; border-radius:50%; background:#334155;"></div><div><span style="display:block; font-weight:bold;" data-i18n="name_maymouna">ميمونه فاروق</span><span style="font-size:11px; color:var(--text-secondary);">shareholder.m@ecode.sa</span></div></div></td>
                                        <td><span class="role-badge role-user" data-i18n="role_shareholder">مساهم</span></td>
                                        <td data-i18n="dept_share">المساهمين</td>
                                        <td>2025-05-01</td>
                                        <td><span class="badge" style="background:rgba(126,221,163,0.15); color:var(--success-color); padding:4px 10px; border-radius:12px; font-size:11px;" data-i18n="status_active">نشط</span></td>
                                        <td><button onclick="editUser(this)" style="background:none; border:none; color:var(--text-secondary); cursor:pointer;"><i class="fas fa-edit"></i></button></td>
                                    </tr>
                                    <tr id="row-11">
                                        <td><div style="display:flex; align-items:center; gap:10px;"><div style="width:35px; height:35px; border-radius:50%; background:#334155;"></div><div><span style="display:block; font-weight:bold;" data-i18n="name_osama">اسامه الجنيدي</span><span style="font-size:11px; color:var(--text-secondary);">shareholder.o@ecode.sa</span></div></div></td>
                                        <td><span class="role-badge role-user" data-i18n="role_shareholder">مساهم</span></td>
                                        <td data-i18n="dept_share">المساهمين</td>
                                        <td>2025-05-10</td>
                                        <td><span class="badge" style="background:rgba(126,221,163,0.15); color:var(--success-color); padding:4px 10px; border-radius:12px; font-size:11px;" data-i18n="status_active">نشط</span></td>
                                        <td><button onclick="editUser(this)" style="background:none; border:none; color:var(--text-secondary); cursor:pointer;"><i class="fas fa-edit"></i></button></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div id="roles-view" style="display:none;">
                    <div class="roles-layout">
                        <div class="roles-list" id="rolesList">
                            <div class="role-item active" onclick="selectRole(this, 'ceo')"><span data-i18n="role_ceo">الرئيس التنفيذي</span> <i class="fas fa-chevron-left"></i></div>
                            <div class="role-item" onclick="selectRole(this, 'cfo')"><span data-i18n="role_cfo">المدير المالي</span> <i class="fas fa-chevron-left"></i></div>
                            <div class="role-item" onclick="selectRole(this, 'hr')"><span data-i18n="role_hr">مدير الموارد</span> <i class="fas fa-chevron-left"></i></div>
                            <div class="role-item" onclick="selectRole(this, 'it')"><span data-i18n="role_cto">مدير التقنية</span> <i class="fas fa-chevron-left"></i></div>
                            <div class="role-item" onclick="selectRole(this, 'audit')"><span data-i18n="role_audit">المدقق الداخلي</span> <i class="fas fa-chevron-left"></i></div>
                            <div class="role-item add-new-role" onclick="openModal('addRoleModal')">
                                <span><i class="fas fa-plus-circle"></i> <span data-i18n="btn_add_role">إضافة وظيفة جديدة</span></span>
                            </div>
                        </div>
                        
                        <div class="section-card">
                            <h2 id="selectedRoleTitle" style="color:var(--secondary-color); margin-bottom:20px;">صلاحيات: الرئيس التنفيذي</h2>
                            <div style="margin-bottom:20px; border-bottom:1px solid var(--border-color); padding-bottom:20px;">
                                <h4 style="margin-bottom:15px;"><i class="fas fa-coins" style="color:var(--warning-color);"></i> <span data-i18n="perm_financial">الصلاحيات المالية</span></h4>
                                <div style="background:var(--bg-primary); padding:15px; border-radius:12px; border:1px solid var(--border-color);">
                                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                                        <span data-i18n="perm_limit">تفعيل الاعتماد المباشر للطلبات الأقل من:</span>
                                        <div style="display:flex; align-items:center; gap:10px;">
                                            <input type="number" id="financialLimit" value="50000" class="form-input" style="width:100px; text-align:center;">
                                            <span data-i18n="currency">ريال</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div style="margin-bottom:20px;">
                                <h4 style="margin-bottom:15px;"><i class="fas fa-users-cog" style="color:var(--secondary-color);"></i> <span data-i18n="perm_admin">الإدارة</span></h4>
                                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; padding:10px; background:var(--bg-primary); border-radius:8px;">
                                    <span data-i18n="perm_add_user">إضافة مستخدمين جدد</span>
                                    <label class="switch"><input type="checkbox" id="permAddUser" checked><span class="slider"></span></label>
                                </div>
                                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; padding:10px; background:var(--bg-primary); border-radius:8px;">
                                    <span data-i18n="perm_delete_user">حذف حسابات</span>
                                    <label class="switch"><input type="checkbox" id="permDeleteUser"><span class="slider"></span></label>
                                </div>
                            </div>
                            <button onclick="alert('تم الحفظ')" style="width:100%; background:var(--primary-color); color:#fff; border:none; padding:12px; border-radius:8px; cursor:pointer;" data-i18n="btn_save_changes">حفظ التغييرات</button>
                        </div>
                    </div>
                </div>

            </main>
        </div>
    </div>

    <script src="../assets/js/core/i18n.js"></script>
    <script src="../assets/js/layout.js"></script>
    <script src="../assets/js/components/bot.js"></script>
    <script src="../assets/js/system.js"></script>

    <script>
        // قاموس الترجمة الشامل لجميع الأسماء والوظائف
        const pageTranslations = {
            ar: {
                tab_users: "إدارة المستخدمين", tab_roles: "هيكل الصلاحيات",
                stat_total: "إجمالي المستخدمين", stat_active: "نشط حالياً", stat_admins: "مدراء النظام", stat_blocked: "محظورين",
                ph_search: "بحث عن مستخدم...", btn_add_user: "مستخدم جديد",
                col_user: "المستخدم", col_role: "الدور الوظيفي", col_dept: "القسم", col_join: "تاريخ الانضمام", col_status: "الحالة", col_actions: "إجراءات",
                
                // أسماء المستخدمين
                name_mutaz: "معتز سعود", name_ali: "علي ابراهيم", name_ayman: "أيمن المغربي", name_abdulaziz: "عبدالعزيز سلطان",
                name_ibrahim: "ابراهيم اياد", name_ahmed: "احمد عبد القادر", name_amjad: "امجاد علي", name_inas: "ايناس الطيب",
                name_amal: "امل خالد", name_maymouna: "ميمونه فاروق", name_osama: "اسامه الجنيدي",

                // الوظائف والأقسام
                role_ceo: "الرئيس التنفيذي", role_board: "رئيس المجلس", role_admin: "مدير النظام", role_cto: "مدير التقنية", role_cfo: "المدير المالي", role_hr: "مدير الموارد", role_sales: "مدير المبيعات", role_audit: "المدقق الداخلي", role_sec: "أمين السر", role_shareholder: "مساهم",
                dept_top: "الإدارة العليا", dept_board: "مجلس الإدارة", dept_it: "تقنية المعلومات", dept_finance: "الإدارة المالية", dept_hr: "الموارد البشرية", dept_sales: "المبيعات", dept_audit: "التدقيق", dept_share: "المساهمين",
                
                status_active: "نشط", btn_save_changes: "حفظ التغييرات", btn_add_role: "إضافة وظيفة جديدة",
                perm_financial: "الصلاحيات المالية", perm_admin: "الإدارة والمستخدمين", perm_limit: "سقف الاعتماد المباشر", currency: "ريال",
                perm_add_user: "إضافة مستخدمين", perm_delete_user: "حذف حسابات",
                modal_add_user: "إضافة مستخدم جديد", lbl_name: "الاسم الكامل", lbl_email: "البريد الإلكتروني", btn_cancel: "إلغاء", btn_save: "حفظ", btn_create: "إنشاء", lbl_role_name: "اسم الوظيفة"
            },
            en: {
                tab_users: "User Management", tab_roles: "Role Structure",
                stat_total: "Total Users", stat_active: "Active Now", stat_admins: "System Admins", stat_blocked: "Blocked",
                ph_search: "Search users...", btn_add_user: "New User",
                col_user: "User", col_role: "Role", col_dept: "Department", col_join: "Join Date", col_status: "Status", col_actions: "Actions",
                
                // User Names
                name_mutaz: "Mutaz Saud", name_ali: "Ali Ibrahim", name_ayman: "Ayman Al-Maghrabi", name_abdulaziz: "Abdulaziz Sultan",
                name_ibrahim: "Ibrahim Iyad", name_ahmed: "Ahmed Abdulqader", name_amjad: "Amjad Ali", name_inas: "Inas Al-Tayeb",
                name_amal: "Amal Khaled", name_maymouna: "Maymouna Farouk", name_osama: "Osama Al-Junaidi",

                // Roles & Depts
                role_ceo: "CEO", role_board: "Chairman", role_admin: "Sys Admin", role_cto: "CTO", role_cfo: "CFO", role_hr: "HR Manager", role_sales: "Sales Mgr", role_audit: "Auditor", role_sec: "Secretary", role_shareholder: "Shareholder",
                dept_top: "Top Mgmt", dept_board: "Board", dept_it: "IT Dept", dept_finance: "Finance", dept_hr: "HR", dept_sales: "Sales", dept_audit: "Audit", dept_share: "Shareholders",
                
                status_active: "Active", btn_save_changes: "Save Changes", btn_add_role: "Add New Role",
                perm_financial: "Financial Auth", perm_admin: "Admin Privileges", perm_limit: "Auto-Approval Limit", currency: "SAR",
                perm_add_user: "Add New Users", perm_delete_user: "Delete Accounts",
                modal_add_user: "Add New User", lbl_name: "Full Name", lbl_email: "Email Address", btn_cancel: "Cancel", btn_save: "Save", btn_create: "Create", lbl_role_name: "Role Name"
            }
        };

        // دمج الترجمة وتشغيلها
        document.addEventListener('DOMContentLoaded', () => {
            if(window.SYSTEM_TRANSLATIONS) {
                Object.assign(window.SYSTEM_TRANSLATIONS.ar, pageTranslations.ar);
                Object.assign(window.SYSTEM_TRANSLATIONS.en, pageTranslations.en);
                
                // تحديث اللغة فوراً عند التحميل
                const lang = localStorage.getItem('eGov_Lang') || 'ar';
                if(window.updateLanguage) window.updateLanguage(lang);
            }
        });

        // ============================
        // المنطق الخاص بالصفحة (Logic)
        // ============================

        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('tab-' + tab + '-btn').classList.add('active');
            
            document.getElementById('users-view').style.display = tab === 'users' ? 'block' : 'none';
            document.getElementById('roles-view').style.display = tab === 'roles' ? 'block' : 'none';
        }

        function openModal(id, mode) {
            document.getElementById(id).style.display = 'flex';
            if(id === 'userModal' && mode === 'add') {
                document.getElementById('modalTitle').innerText = "إضافة مستخدم جديد";
                document.getElementById('modalName').value = '';
                document.getElementById('modalEmail').value = '';
            }
        }

        function closeModal(id) {
            document.getElementById(id).style.display = 'none';
        }

        function saveUser() {
            // محاكاة حفظ المستخدم
            alert('تم الحفظ بنجاح (محاكاة)');
            closeModal('userModal');
        }

        function editUser(btn) {
            const row = btn.closest('tr');
            // محاولة جلب الاسم سواء كان مترجماً أو لا
            const nameEl = row.querySelector('span[style*="font-weight:bold"]');
            const name = nameEl.innerText;
            
            openModal('userModal', 'edit');
            document.getElementById('modalTitle').innerText = "تعديل المستخدم";
            document.getElementById('modalName').value = name;
        }

        function selectRole(el, role) {
            document.querySelectorAll('.role-item').forEach(i => i.classList.remove('active'));
            el.classList.add('active');
            
            const roleName = el.querySelector('span').innerText;
            // إضافة البادئة حسب اللغة
            const lang = localStorage.getItem('eGov_Lang') || 'ar';
            const prefix = lang === 'en' ? 'Permissions: ' : 'صلاحيات: ';
            document.getElementById('selectedRoleTitle').innerText = prefix + roleName;

            const limitInput = document.getElementById('financialLimit');
            const chkAdd = document.getElementById('permAddUser');
            const chkDel = document.getElementById('permDeleteUser');

            // منطق المحاكاة
            if (role === 'ceo') {
                limitInput.value = 50000;
                chkAdd.checked = true;
                chkDel.checked = false;
            } else if (role === 'cfo') {
                limitInput.value = 10000;
                chkAdd.checked = false;
                chkDel.checked = false;
            } else if (role === 'it') {
                limitInput.value = 5000;
                chkAdd.checked = true;
                chkDel.checked = true;
            } else {
                limitInput.value = 0;
                chkAdd.checked = false;
                chkDel.checked = false;
            }
        }

        function saveNewRole() {
            const roleName = document.getElementById('newRoleName').value;
            if(!roleName) return;

            const list = document.getElementById('rolesList');
            const btn = document.querySelector('.add-new-role');
            
            const newItem = document.createElement('div');
            newItem.className = 'role-item';
            // إضافة النص مباشرة (لن يترجم تلقائياً لأنه جديد، وهذا طبيعي)
            newItem.innerHTML = `<span>${roleName}</span> <i class="fas fa-chevron-left"></i>`;
            newItem.onclick = function() { selectRole(this, 'new'); };
            
            list.insertBefore(newItem, btn);
            closeModal('addRoleModal');
            document.getElementById('newRoleName').value = '';
            selectRole(newItem, 'new');
        }

        function filterUsers() {
            let input = document.getElementById('userSearch').value.toLowerCase();
            let rows = document.querySelectorAll('#usersTableBody tr');
            rows.forEach(row => {
                let text = row.innerText.toLowerCase();
                row.style.display = text.includes(input) ? '' : 'none';
            });
        }
    </script>

</body>
</html>
