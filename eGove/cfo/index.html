<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>eGov - الرقابة المالية | نظرة عامة</title>
    
    <link rel="stylesheet" href="../admin/assets/css/style.css">
    <style>
        .finance-card {
            background: #fff;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border-top: 4px solid var(--primary-color);
            transition: transform 0.2s;
        }
        .finance-card:hover { transform: translateY(-5px); }
        .metric-value { font-size: 2rem; font-weight: bold; color: #2c3e50; }
        .metric-label { color: #7f8c8d; font-size: 0.9rem; }
        .trend-up { color: #27ae60; font-size: 0.8rem; }
        .trend-down { color: #c0392b; font-size: 0.8rem; }
        
        .governance-badge {
            background: #f1c40f; /* لون تحذيري للامتثال */
            color: #2c3e50;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
    </style>
</head>
<body class="finance-layout">

    <div id="sidebar-container"></div>

    <main class="main-content">
        <header id="header-container"></header>

        <div class="content-wrapper">
            
            <div class="page-header d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h1 class="h3">لوحة الرقابة المالية</h1>
                    <p class="text-muted">نظرة شمولية على السيولة، الالتزامات، والامتثال للموازنة.</p>
                </div>
                <div class="governance-status">
                    <span class="governance-badge">
                        <i class="fas fa-shield-alt"></i>
                        السياسات المالية: محدثة ومعتمدة (v2.4)
                    </span>
                </div>
            </div>

            <div class="row g-4 mb-4">
                <div class="col-md-3">
                    <div class="finance-card">
                        <div class="metric-label">السيولة النقدية المتوفرة</div>
                        <div class="metric-value" id="cash-balance">--</div>
                        <div class="trend-up">▲ 12% عن الشهر الماضي</div>
                    </div>
                </div>
                
                <div class="col-md-3">
                    <div class="finance-card" style="border-color: #e74c3c;">
                        <div class="metric-label">التزامات مستحقة (موردين)</div>
                        <div class="metric-value" id="ap-balance">--</div>
                        <div class="text-muted small">تستحق خلال 30 يوم</div>
                    </div>
                </div>

                <div class="col-md-3">
                    <div class="finance-card" style="border-color: #27ae60;">
                        <div class="metric-label">تحصيلات متوقعة (عملاء)</div>
                        <div class="metric-value" id="ar-balance">--</div>
                        <div class="trend-up">85% نسبة التحصيل</div>
                    </div>
                </div>

                <div class="col-md-3">
                    <div class="finance-card" style="border-color: #f39c12;">
                        <div class="metric-label">نسبة استهلاك الموازنة</div>
                        <div class="metric-value" id="budget-usage">--%</div>
                        <div id="budget-status" class="small">--</div>
                    </div>
                </div>
            </div>

            <div class="row g-4">
                <div class="col-lg-8">
                    <div class="card h-100 border-0 shadow-sm">
                        <div class="card-header bg-white border-0 d-flex justify-content-between">
                            <h5 class="card-title">التدفقات النقدية (Cash Flow)</h5>
                            <button class="btn btn-sm btn-outline-primary">تقرير مفصل</button>
                        </div>
                        <div class="card-body d-flex align-items-center justify-content-center bg-light">
                            <p class="text-muted">سيتم ربط الرسم البياني بمكتبة Chart.js لاحقاً</p>
                        </div>
                    </div>
                </div>

                <div class="col-lg-4">
                    <div class="card h-100 border-0 shadow-sm">
                        <div class="card-header bg-white border-0">
                            <h5 class="card-title">تنبيهات الحوكمة</h5>
                        </div>
                        <div class="card-body p-0">
                            <ul class="list-group list-group-flush" id="governance-alerts">
                                <li class="list-group-item d-flex justify-content-between align-items-start">
                                    <div class="ms-2 me-auto">
                                        <div class="fw-bold text-danger">تجاوز حد الصرف</div>
                                        طلب شراء #402 يتجاوز صلاحية المدير
                                    </div>
                                    <button class="btn btn-sm btn-danger rounded-pill">رفض آلي</button>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <script src="../admin/js/core/config.js"></script>
    <script src="../admin/js/core/i18n.js"></script>
    <script src="../admin/js/core/auth.js"></script>
    
    <script src="../admin/data/company_data.js"></script>
    <script src="../admin/data/financial-governance.js"></script>
    
    <script src="../admin/assets/layout.js"></script>
    <script src="../admin/js/components/bot.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // 1. Check Auth (CFO Role)
            // Auth.guard('CFO'); // سنفعلها لاحقاً

            // 2. Load Governance Data from centralized file
            // محاكاة جلب البيانات للعرض (Mocking Data Loading)
            // في الواقع ستأتي هذه القيم من دالة FinancialGovernance.getDashboardStats()
            
            document.getElementById('cash-balance').innerText = "1,250,000 ر.س";
            document.getElementById('ap-balance').innerText = "145,000 ر.س";
            document.getElementById('ar-balance').innerText = "320,000 ر.س";
            
            const budgetUsage = 65; // Example percentage
            document.getElementById('budget-usage').innerText = budgetUsage + "%";
            
            const budgetStatusEl = document.getElementById('budget-status');
            if(budgetUsage > 80) {
                budgetStatusEl.innerHTML = '<span class="text-danger">⚠️ يقترب من الحد المسموح</span>';
            } else {
                budgetStatusEl.innerHTML = '<span class="text-success">✅ ضمن الحدود الآمنة</span>';
            }
            
            console.log("Finance Dashboard: Governance Policies enforced via admin/data/financial-governance.js");
        });
    </script>
</body>
</html>
