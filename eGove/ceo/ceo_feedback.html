<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#FB4747">
    <title>صندوق الشكاوي | AndroGov</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: { brandRed: '#FB4747', brandDark: '#0F172A', moneyGreen: '#10B981', alertOrange: '#F59E0B' },
                    fontFamily: { sans: ['Tajawal', 'Inter', 'sans-serif'], en: ['Inter', 'sans-serif'] }
                }
            }
        }
    </script>
    <style>
        .num-font { font-family: 'Inter', sans-serif; font-feature-settings: "tnum"; }
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #CBD5E1; border-radius: 10px; }
        .custom-scroll::-webkit-scrollbar-thumb:hover { background: #94A3B8; }
        .dark .custom-scroll::-webkit-scrollbar-thumb { background: #475569; }
        @keyframes fade-in-up {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in-up { animation: fade-in-up 0.3s ease-out; }
    </style>
</head>
<body class="bg-slate-50 dark:bg-slate-900 text-slate-800 dark:text-slate-100 font-sans transition-colors duration-300">

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 bg-white dark:bg-slate-900 z-[9999] flex items-center justify-center transition-opacity duration-500">
        <div class="text-center">
            <div class="w-16 h-16 border-4 border-brandRed border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
            <p class="text-sm text-slate-600 dark:text-slate-400 font-medium">جاري تحميل صندوق الشكاوي...</p>
        </div>
    </div>

    <div id="sidebar-container"></div>
    
    <div class="main-content-wrapper transition-all duration-300 flex flex-col min-h-screen md:mr-72">
        
        <div id="header-container"></div>

        <main class="p-8 space-y-8">
            
            <!-- Page Header -->
            <div class="flex flex-col md:flex-row justify-between items-end gap-6 bg-gradient-to-br from-amber-600 to-orange-700 text-white p-8 rounded-3xl shadow-xl relative overflow-hidden">
                <div class="absolute -right-10 -top-10 w-40 h-40 bg-white/10 rounded-full blur-3xl"></div>
                <div class="absolute -left-10 -bottom-10 w-40 h-40 bg-yellow-500/20 rounded-full blur-3xl"></div>
                
                <div class="relative z-10">
                    <div class="flex items-center gap-3 mb-3">
                        <span class="px-3 py-1.5 bg-white/20 rounded-lg text-[10px] border border-white/30 uppercase tracking-wider font-bold backdrop-blur-sm">
                            <i class="fa-solid fa-shield-heart mr-1"></i>
                            <span data-i18n="lblAccess">Employee Voice</span>
                        </span>
                    </div>
                    <h1 class="text-3xl font-bold flex items-center gap-3 mb-2">
                        <i class="fa-solid fa-inbox text-yellow-200 text-4xl"></i>
                        <span data-i18n="headerTitle">صندوق الشكاوي والمقترحات</span>
                    </h1>
                    <p class="text-sm text-amber-50 mt-2 max-w-2xl leading-relaxed" data-i18n="headerDesc">
                        قناة التواصل المباشرة للاستماع لصوت الموظفين والمساهمة في تحسين بيئة العمل.
                    </p>
                </div>
                
                <div class="flex gap-3 relative z-10">
                    <div class="flex items-center gap-2 bg-white/10 rounded-lg p-1 backdrop-blur-sm">
                        <button class="px-4 py-2 bg-white text-amber-600 shadow-sm rounded-md text-xs font-bold transition" data-i18n="filterAll">
                            الكل
                        </button>
                        <button class="px-4 py-2 text-xs font-bold text-white hover:bg-white/10 transition" data-i18n="filterUnread">
                            غير مقروء
                        </button>
                        <button class="px-4 py-2 text-xs font-bold text-white hover:bg-white/10 transition" data-i18n="filterUrgent">
                            عاجل
                        </button>
                    </div>
                </div>
            </div>

            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Ideas -->
                <div class="bg-white dark:bg-slate-800 p-6 rounded-3xl shadow-sm border border-slate-100 dark:border-slate-700 flex items-center gap-4 group hover:shadow-lg hover:border-blue-500/30 transition">
                    <div class="w-16 h-16 rounded-2xl bg-blue-50 dark:bg-blue-900/20 text-blue-600 flex items-center justify-center text-3xl group-hover:scale-110 transition-transform shrink-0">
                        <i class="fa-solid fa-lightbulb"></i>
                    </div>
                    <div>
                        <h3 class="text-4xl font-bold num-font text-slate-900 dark:text-white">15</h3>
                        <p class="text-xs text-slate-500 dark:text-slate-400 uppercase tracking-wider mt-1" data-i18n="statIdeas">
                            مقترحات تطويرية
                        </p>
                    </div>
                </div>

                <!-- Complaints -->
                <div class="bg-white dark:bg-slate-800 p-6 rounded-3xl shadow-sm border border-slate-100 dark:border-slate-700 flex items-center gap-4 group hover:shadow-lg hover:border-red-500/30 transition">
                    <div class="w-16 h-16 rounded-2xl bg-red-50 dark:bg-red-900/20 text-red-600 flex items-center justify-center text-3xl group-hover:scale-110 transition-transform shrink-0">
                        <i class="fa-solid fa-triangle-exclamation"></i>
                    </div>
                    <div>
                        <h3 class="text-4xl font-bold num-font text-slate-900 dark:text-white">3</h3>
                        <p class="text-xs text-slate-500 dark:text-slate-400 uppercase tracking-wider mt-1" data-i18n="statComplaints">
                            شكاوي نشطة
                        </p>
                    </div>
                </div>

                <!-- Resolved -->
                <div class="bg-white dark:bg-slate-800 p-6 rounded-3xl shadow-sm border border-slate-100 dark:border-slate-700 flex items-center gap-4 group hover:shadow-lg hover:border-green-500/30 transition">
                    <div class="w-16 h-16 rounded-2xl bg-green-50 dark:bg-green-900/20 text-green-600 flex items-center justify-center text-3xl group-hover:scale-110 transition-transform shrink-0">
                        <i class="fa-solid fa-check-double"></i>
                    </div>
                    <div>
                        <h3 class="text-4xl font-bold num-font text-slate-900 dark:text-white">42</h3>
                        <p class="text-xs text-slate-500 dark:text-slate-400 uppercase tracking-wider mt-1" data-i18n="statResolved">
                            تمت معالجتها
                        </p>
                    </div>
                </div>
            </div>

            <!-- Feedback Items -->
            <div class="space-y-4">
                
                <!-- Complaint - Urgent -->
                <div class="bg-white dark:bg-slate-800 rounded-2xl p-6 shadow-sm border-l-4 border-red-500 hover:shadow-lg transition cursor-pointer group" onclick="openMessage('msg1')">
                    <div class="flex justify-between items-start mb-3">
                        <div class="flex items-center gap-3">
                            <div class="w-12 h-12 rounded-xl bg-red-100 dark:bg-red-900/30 text-red-600 flex items-center justify-center shrink-0">
                                <i class="fa-solid fa-exclamation-triangle"></i>
                            </div>
                            <div>
                                <div class="flex items-center gap-2 mb-1">
                                    <span class="bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400 text-xs px-2.5 py-1 rounded-lg font-bold" data-i18n="tagComplaint">
                                        شكوى
                                    </span>
                                    <span class="bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 text-xs px-2.5 py-1 rounded-lg font-bold flex items-center gap-1">
                                        <i class="fa-solid fa-user-secret"></i> 
                                        <span data-i18n="tagAnon">مجهول</span>
                                    </span>
                                </div>
                                <h3 class="font-bold text-base text-slate-900 dark:text-white group-hover:text-brandRed transition" data-i18n="msg1Title">
                                    تجاوزات إدارية في فرع الشمال
                                </h3>
                            </div>
                        </div>
                        <span class="text-xs text-slate-400 num-font" data-i18n="time2h">منذ ساعتين</span>
                    </div>
                    <p class="text-sm text-slate-600 dark:text-slate-300 line-clamp-2 mr-16" data-i18n="msg1Desc">
                        أود الإبلاغ عن وجود محسوبيات في توزيع الورديات الإضافية (Overtime) في فرع الشمال، حيث يتم إسنادها لأشخاص محددين دون غيرهم...
                    </p>
                </div>

                <!-- Suggestion -->
                <div class="bg-white dark:bg-slate-800 rounded-2xl p-6 shadow-sm border-l-4 border-blue-500 hover:shadow-lg transition cursor-pointer group" onclick="openMessage('msg2')">
                    <div class="flex justify-between items-start mb-3">
                        <div class="flex items-center gap-3">
                            <div class="w-12 h-12 rounded-xl bg-blue-100 dark:bg-blue-900/30 text-blue-600 flex items-center justify-center shrink-0">
                                <i class="fa-solid fa-lightbulb"></i>
                            </div>
                            <div>
                                <div class="flex items-center gap-2 mb-1">
                                    <span class="bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 text-xs px-2.5 py-1 rounded-lg font-bold" data-i18n="tagSuggest">
                                        مقترح
                                    </span>
                                </div>
                                <h3 class="font-bold text-base text-slate-900 dark:text-white group-hover:text-blue-600 transition" data-i18n="msg2Title">
                                    تحسين سياسة العمل عن بعد
                                </h3>
                            </div>
                        </div>
                        <span class="text-xs text-slate-400 num-font" data-i18n="timeYesterday">أمس</span>
                    </div>
                    <p class="text-sm text-slate-600 dark:text-slate-300 line-clamp-2 mr-16 mb-3" data-i18n="msg2Desc">
                        أقترح زيادة عدد أيام العمل عن بعد للموظفين الذين يحققون المستهدفات بنسبة 100% كنوع من الحافز المعنوي...
                    </p>
                    <div class="flex items-center gap-2 mr-16">
                        <img src="https://ui-avatars.com/api/?name=Sarah+A&background=3B82F6&color=fff" 
                             class="w-6 h-6 rounded-full">
                        <span class="text-xs text-slate-400" data-i18n="msg2User">سارة الأحمد - التسويق</span>
                    </div>
                </div>

                <!-- Inquiry - Resolved -->
                <div class="bg-white dark:bg-slate-800 rounded-2xl p-6 shadow-sm border-l-4 border-slate-300 hover:shadow-lg transition cursor-pointer group opacity-75">
                    <div class="flex justify-between items-start mb-3">
                        <div class="flex items-center gap-3">
                            <div class="w-12 h-12 rounded-xl bg-slate-100 dark:bg-slate-700 text-slate-500 dark:text-slate-400 flex items-center justify-center shrink-0">
                                <i class="fa-solid fa-circle-question"></i>
                            </div>
                            <div>
                                <div class="flex items-center gap-2 mb-1">
                                    <span class="bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 text-xs px-2.5 py-1 rounded-lg font-bold" data-i18n="tagInquiry">
                                        استفسار
                                    </span>
                                    <span class="text-green-600 dark:text-green-400 text-xs font-bold flex items-center gap-1">
                                        <i class="fa-solid fa-check"></i> 
                                        <span data-i18n="tagReplied">تم الرد</span>
                                    </span>
                                </div>
                                <h3 class="font-bold text-base text-slate-900 dark:text-white" data-i18n="msg3Title">
                                    موعد صرف البونص السنوي
                                </h3>
                            </div>
                        </div>
                        <span class="text-xs text-slate-400 num-font" data-i18n="time3d">منذ 3 أيام</span>
                    </div>
                    <p class="text-sm text-slate-600 dark:text-slate-300 line-clamp-2 mr-16" data-i18n="msg3Desc">
                        متى سيتم إيداع البونص السنوي في الحسابات؟ وهل يشمل الموظفين الجدد؟
                    </p>
                </div>

            </div>

        </main>
    </div>

    <!-- Message Detail Modal -->
    <div id="messageModal" class="fixed inset-0 bg-black/60 hidden z-50 flex items-center justify-center backdrop-blur-sm p-4">
        <div class="bg-white dark:bg-slate-800 w-full max-w-2xl rounded-3xl shadow-2xl overflow-hidden animate-fade-in-up">
            
            <!-- Modal Header -->
            <div class="bg-gradient-to-r from-red-500 to-orange-600 p-6 flex justify-between items-start">
                <div>
                    <div class="flex items-center gap-3 mb-2">
                        <span class="bg-white/20 text-white text-xs px-3 py-1 rounded-lg font-bold backdrop-blur-sm" data-i18n="tagComplaint">
                            شكوى
                        </span>
                        <span class="text-xs text-white/80 num-font">#TICKET-209</span>
                    </div>
                    <h3 class="text-xl font-bold text-white" data-i18n="msg1Title">
                        تجاوزات إدارية في فرع الشمال
                    </h3>
                </div>
                <button onclick="document.getElementById('messageModal').classList.add('hidden')" 
                        class="w-10 h-10 rounded-full bg-white/20 hover:bg-white/30 text-white transition flex items-center justify-center">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>

            <!-- Modal Content -->
            <div class="p-6 h-96 overflow-y-auto custom-scroll text-sm text-slate-600 dark:text-slate-300 leading-relaxed space-y-4">
                <p data-i18n="detailP1">سعادة الرئيس التنفيذي،</p>
                <p data-i18n="detailP2">
                    أود الإبلاغ عن وجود محسوبيات واضحة في توزيع ساعات العمل الإضافية (Overtime) في فرع الشمال. يتم إسناد الساعات الإضافية بشكل متكرر لمجموعة محددة من الموظفين المقربين من مدير الفرع، بينما يتم تجاهل باقي الفريق رغم حاجتهم ورغبتهم في العمل.
                </p>
                <p data-i18n="detailP3">
                    هذا التصرف يؤثر سلباً على معنويات الفريق ويخلق بيئة عمل غير عادلة. نرجو من سعادتكم التوجيه بالتحقيق في سجلات الحضور والانصراف ومسيرات الرواتب للتأكد من صحة هذه المعلومات.
                </p>
                <p data-i18n="detailP4" class="font-medium">مقدمه: فاعل خير (موظف في الفرع)</p>
            </div>

            <!-- Modal Footer -->
            <div class="p-6 border-t border-slate-100 dark:border-slate-700 bg-slate-50 dark:bg-slate-900/30 flex justify-between items-center">
                <div class="flex gap-2">
                    <button class="px-4 py-2.5 bg-white dark:bg-slate-700 border border-slate-200 dark:border-slate-600 text-slate-600 dark:text-white text-sm font-bold rounded-xl hover:bg-slate-50 dark:hover:bg-slate-600 transition flex items-center gap-2" onclick="Toast.success('Saved')">
                        <i class="fa-regular fa-bookmark"></i> 
                        <span data-i18n="btnSave">حفظ</span>
                    </button>
                    <button class="px-4 py-2.5 bg-white dark:bg-slate-700 border border-slate-200 dark:border-slate-600 text-slate-600 dark:text-white text-sm font-bold rounded-xl hover:bg-slate-50 dark:hover:bg-slate-600 transition flex items-center gap-2" onclick="Toast.success('Forwarded to HR')">
                        <i class="fa-solid fa-share"></i> 
                        <span data-i18n="btnForward">تحويل لـ HR</span>
                    </button>
                </div>
                <button class="px-6 py-2.5 bg-gradient-to-r from-brandRed to-red-600 hover:from-red-600 hover:to-red-700 text-white text-sm font-bold rounded-xl shadow-lg transition flex items-center gap-2" onclick="Toast.info('Opening reply box...')">
                    <i class="fa-solid fa-reply"></i> 
                    <span data-i18n="btnReply">رد / توجيه</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        const pageContent = {
            ar: {
                pageTitle: "صندوق الشكاوي | AndroGov",
                lblAccess: "صوت الموظفين",
                headerTitle: "صندوق الشكاوي والمقترحات",
                headerDesc: "قناة التواصل المباشرة للاستماع لصوت الموظفين والمساهمة في تحسين بيئة العمل.",
                filterAll: "الكل",
                filterUnread: "غير مقروء",
                filterUrgent: "عاجل",
                statIdeas: "مقترحات تطويرية",
                statComplaints: "شكاوي نشطة",
                statResolved: "تمت معالجتها",
                tagComplaint: "شكوى",
                tagAnon: "مجهول",
                tagSuggest: "مقترح",
                tagInquiry: "استفسار",
                tagReplied: "تم الرد",
                msg1Title: "تجاوزات إدارية في فرع الشمال",
                msg1Desc: "أود الإبلاغ عن وجود محسوبيات في توزيع الورديات الإضافية (Overtime) في فرع الشمال...",
                time2h: "منذ ساعتين",
                msg2Title: "تحسين سياسة العمل عن بعد",
                msg2Desc: "أقترح زيادة عدد أيام العمل عن بعد للموظفين الذين يحققون المستهدفات بنسبة 100%...",
                msg2User: "سارة الأحمد - التسويق",
                timeYesterday: "أمس",
                msg3Title: "موعد صرف البونص السنوي",
                msg3Desc: "متى سيتم إيداع البونص السنوي في الحسابات؟ وهل يشمل الموظفين الجدد؟",
                time3d: "منذ 3 أيام",
                detailP1: "سعادة الرئيس التنفيذي،",
                detailP2: "أود الإبلاغ عن وجود محسوبيات واضحة في توزيع ساعات العمل الإضافية...",
                detailP3: "هذا التصرف يؤثر سلباً على معنويات الفريق...",
                detailP4: "مقدمه: فاعل خير (موظف في الفرع)",
                btnSave: "حفظ",
                btnForward: "تحويل لـ HR",
                btnReply: "رد / توجيه"
            },
            en: {
                pageTitle: "Feedback | AndroGov",
                lblAccess: "Employee Voice",
                headerTitle: "Feedback & Complaints",
                headerDesc: "Direct channel to hear employee voices and improve the work environment.",
                filterAll: "All",
                filterUnread: "Unread",
                filterUrgent: "Urgent",
                statIdeas: "Suggestions",
                statComplaints: "Active Complaints",
                statResolved: "Resolved",
                tagComplaint: "Complaint",
                tagAnon: "Anonymous",
                tagSuggest: "Suggestion",
                tagInquiry: "Inquiry",
                tagReplied: "Replied",
                msg1Title: "Administrative issues in North Branch",
                msg1Desc: "I would like to report favoritism in assigning Overtime shifts in the North Branch...",
                time2h: "2h ago",
                msg2Title: "Remote Work Policy Enhancement",
                msg2Desc: "I suggest increasing remote work days for employees achieving 100% of targets...",
                msg2User: "Sarah Al-Ahmed - Marketing",
                timeYesterday: "Yesterday",
                msg3Title: "Annual Bonus Payment Date",
                msg3Desc: "When will the annual bonus be deposited? Does it cover new hires?",
                time3d: "3 days ago",
                detailP1: "Dear CEO,",
                detailP2: "I would like to report clear favoritism in assigning Overtime shifts...",
                detailP3: "This behavior negatively affects team morale...",
                detailP4: "Sender: Anonymous (Branch Employee)",
                btnSave: "Save",
                btnForward: "Forward to HR",
                btnReply: "Reply / Forward"
            }
        };

        // ==========================================
        // MODAL FUNCTIONS
        // ==========================================
        function openMessage(id) {
            document.getElementById('messageModal').classList.remove('hidden');
        }

        // ==========================================
        // UPDATE CONTENT FUNCTION
        // ==========================================
        window.updateContent = function() {
            const lang = Layout.getCurrentLang();
            const dict = pageContent[lang];
            
            document.title = dict.pageTitle;
            
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (dict[key]) {
                    const icon = el.querySelector('i');
                    if (icon) {
                        const iconHTML = icon.outerHTML;
                        el.innerHTML = iconHTML + ' ' + dict[key];
                    } else {
                        el.textContent = dict[key];
                    }
                }
            });
        };

        // ==========================================
        // INITIALIZATION
        // ==========================================
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                const overlay = document.getElementById('loadingOverlay');
                if (overlay) {
                    overlay.style.opacity = '0';
                    setTimeout(() => overlay.remove(), 500);
                }
            }, 1000);
            
            const checkReady = setInterval(() => {
                if (typeof Layout !== 'undefined') {
                    clearInterval(checkReady);
                    updateContent();
                    console.log('✅ CEO Feedback Page Ready');
                }
            }, 50);
        });

        window.addEventListener('languageChanged', () => {
            updateContent();
        });
    </script>
    
    <script src="data/company_policy.js"></script>
    <script src="js/core/config.js"></script>
    <script src="js/core/i18n.js"></script>
    <script src="js/services/data-service.js"></script>
    <script src="js/components/toast.js"></script>
    <script src="js/components/role-switcher.js"></script>
    <script src="js/components/layout.js"></script>
    <script src="js/components/bot.js"></script>
</body>
</html>
